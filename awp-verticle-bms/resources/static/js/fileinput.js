!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=a(require("jquery")):a(window.jQuery)}(function(a){"use strict";a.fn.fileinputLocales={},a.fn.fileinputThemes={},String.prototype.setTokens=function(a){var c,d,b=this.toString();for(c in a)a.hasOwnProperty(c)&&(d=new RegExp("{"+c+"}","g"),b=b.replace(d,a[c]));return b};var b,c;b={FRAMES:".kv-preview-thumb",SORT_CSS:"file-sortable",OBJECT_PARAMS:'<param name="controller" value="true" />\n<param name="allowFullScreen" value="true" />\n<param name="allowScriptAccess" value="always" />\n<param name="autoPlay" value="false" />\n<param name="autoStart" value="false" />\n<param name="quality" value="high" />\n',DEFAULT_PREVIEW:'<div class="file-preview-other">\n<span class="{previewFileIconClass}">{previewFileIcon}</span>\n</div>',MODAL_ID:"kvFileinputModal",MODAL_EVENTS:["show","shown","hide","hidden","loaded"],objUrl:window.URL||window.webkitURL,compare:function(a,b,c){return void 0!==a&&(c?a===b:a.match(b))},isIE:function(a){if("Microsoft Internet Explorer"!==navigator.appName)return!1;if(10===a)return new RegExp("msie\\s"+a,"i").test(navigator.userAgent);var c,b=document.createElement("div");return b.innerHTML="<!--[if IE "+a+"]> <i></i> <![endif]-->",c=b.getElementsByTagName("i").length,document.body.appendChild(b),b.parentNode.removeChild(b),c},initModal:function(b){var c=a("body");c.length&&b.appendTo(c)},isEmpty:function(b,c){return void 0===b||null===b||0===b.length||c&&""===a.trim(b)},isArray:function(a){return Array.isArray(a)||"[object Array]"===Object.prototype.toString.call(a)},ifSet:function(a,b,c){return c=c||"",b&&"object"==typeof b&&a in b?b[a]:c},cleanArray:function(a){return a instanceof Array||(a=[]),a.filter(function(a){return void 0!==a&&null!==a})},spliceArray:function(a,b){var c,d=0,e=[];if(!(a instanceof Array))return[];for(c=0;c<a.length;c++)c!==b&&(e[d]=a[c],d++);return e},getNum:function(a,b){return b=b||0,"number"==typeof a?a:("string"==typeof a&&(a=parseFloat(a)),isNaN(a)?b:a)},hasFileAPISupport:function(){return!(!window.File||!window.FileReader)},hasDragDropSupport:function(){var a=document.createElement("div");return!b.isIE(9)&&(void 0!==a.draggable||void 0!==a.ondragstart&&void 0!==a.ondrop)},hasFileUploadSupport:function(){return b.hasFileAPISupport()&&window.FormData},hasBlobSupport:function(){try{return!!window.Blob&&Boolean(new Blob)}catch(a){return!1}},hasArrayBufferViewSupport:function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(a){return!1}},dataURI2Blob:function(a){var e,f,g,h,i,j,c=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,d=b.hasBlobSupport(),k=(d||c)&&window.atob&&window.ArrayBuffer&&window.Uint8Array;if(!k)return null;for(e=a.split(",")[0].indexOf("base64")>=0?atob(a.split(",")[1]):decodeURIComponent(a.split(",")[1]),f=new ArrayBuffer(e.length),g=new Uint8Array(f),h=0;h<e.length;h+=1)g[h]=e.charCodeAt(h);return i=a.split(",")[0].split(":")[1].split(";")[0],d?new Blob([b.hasArrayBufferViewSupport()?g:f],{type:i}):(j=new c,j.append(f),j.getBlob(i))},arrayBuffer2String:function(a){if(window.TextDecoder)return new TextDecoder("utf-8").decode(a);var e,f,g,h,b=Array.prototype.slice.apply(new Uint8Array(a)),c="",d=0;for(e=b.length;e>d;)switch(f=b[d++],f>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:c+=String.fromCharCode(f);break;case 12:case 13:g=b[d++],c+=String.fromCharCode((31&f)<<6|63&g);break;case 14:g=b[d++],h=b[d++],c+=String.fromCharCode((15&f)<<12|(63&g)<<6|(63&h)<<0)}return c},isHtml:function(a){var c,d,b=document.createElement("div");for(b.innerHTML=a,c=b.childNodes,d=c.length;d--;)if(1===c[d].nodeType)return!0;return!1},isSvg:function(a){return a.match(/^\s*<\?xml/i)&&(a.match(/<!DOCTYPE svg/i)||a.match(/<svg/i))},getMimeType:function(a,b,c){switch(a){case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":return"image/jpeg";case"89504E47":return"image/png";case"47494638":return"image/gif";case"49492a00":return"image/tiff";case"52494646":return"image/webp";case"66747970":return"video/3gp";case"4f676753":return"video/ogg";case"1a45dfa3":return"video/mkv";case"000001ba":case"000001b3":return"video/mpeg";case"3026b275":return"video/wmv";case"25504446":return"application/pdf";case"25215053":return"application/ps";case"504b0304":case"504b0506":case"504b0508":return"application/zip";case"377abcaf":return"application/7z";case"75737461":return"application/tar";case"7801730d":return"application/dmg";default:switch(a.substring(0,6)){case"435753":return"application/x-shockwave-flash";case"494433":return"audio/mp3";case"425a68":return"application/bzip";default:switch(a.substring(0,4)){case"424d":return"image/bmp";case"fffb":return"audio/mp3";case"4d5a":return"application/exe";case"1f9d":case"1fa0":return"application/zip";case"1f8b":return"application/gzip";default:return b&&!b.match(/[^\u0000-\u007f]/)?"application/text-plain":c}}}},addCss:function(a,b){a.removeClass(b).addClass(b)},getElement:function(c,d,e){return b.isEmpty(c)||b.isEmpty(c[d])?e:a(c[d])},uniqId:function(){return Math.round((new Date).getTime())+"_"+Math.round(100*Math.random())},htmlEncode:function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},replaceTags:function(b,c){var d=b;return c?(a.each(c,function(a,b){"function"==typeof b&&(b=b()),d=d.split(a).join(b)}),d):d},cleanMemory:function(a){var c=a.is("img")?a.attr("src"):a.find("source").attr("src");b.objUrl.revokeObjectURL(c)},findFileName:function(a){var b=a.lastIndexOf("/");return-1===b&&(b=a.lastIndexOf("\\")),a.split(a.substring(b,b+1)).pop()},checkFullScreen:function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement},toggleFullScreen:function(a){var c=document,d=c.documentElement;d&&a&&!b.checkFullScreen()?d.requestFullscreen?d.requestFullscreen():d.msRequestFullscreen?d.msRequestFullscreen():d.mozRequestFullScreen?d.mozRequestFullScreen():d.webkitRequestFullscreen&&d.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):c.exitFullscreen?c.exitFullscreen():c.msExitFullscreen?c.msExitFullscreen():c.mozCancelFullScreen?c.mozCancelFullScreen():c.webkitExitFullscreen&&c.webkitExitFullscreen()},moveArray:function(a,b,c){if(c>=a.length)for(var d=c-a.length;d--+1;)a.push(void 0);return a.splice(c,0,a.splice(b,1)[0]),a},cleanZoomCache:function(a){var b=a.closest(".kv-zoom-cache-theme");b.length||(b=a.closest(".kv-zoom-cache")),b.remove()},setOrientation:function(a,b){var f,g,h,c=new DataView(a),d=0,e=1;if(65496!==c.getUint16(d)||a.length<2)return b&&b(),void 0;for(d+=2,f=c.byteLength;f-2>d;)switch(g=c.getUint16(d),d+=2,g){case 65505:h=c.getUint16(d),f=h-d,d+=2;break;case 274:e=c.getUint16(d+6,!1),f=0}b&&b(e)},validateOrientation:function(a,c){if(window.FileReader&&window.DataView){var e,d=new FileReader;d.onloadend=function(){e=d.result,b.setOrientation(e,c)},d.readAsArrayBuffer(a)}},adjustOrientedImage:function(a,b){var c,d,e;if(a.hasClass("is-portrait-gt4")){if(b)return a.css({width:a.parent().height()}),void 0;a.css({height:"auto",width:a.height()}),c=a.parent().offset().top,d=a.offset().top,e=c-d,a.css("margin-top",e)}}},c=function(c,d){var e=this;e.$element=a(c),e.$parent=e.$element.parent(),e._validate()&&(e.isPreviewable=b.hasFileAPISupport(),e.isIE9=b.isIE(9),e.isIE10=b.isIE(10),(e.isPreviewable||e.isIE9)&&(e._init(d),e._listen()),e.$element.removeClass("file-loading"))},c.prototype={constructor:c,_cleanup:function(){var a=this;a.reader=null,a.formdata={},a.uploadCount=0,a.uploadStatus={},a.uploadLog=[],a.uploadAsyncCount=0,a.loadedImages=[],a.totalImagesCount=0,a.ajaxRequests=[],a.clearStack(),a.fileInputCleared=!1,a.fileBatchCompleted=!0,a.isPreviewable||(a.showPreview=!1),a.isError=!1,a.ajaxAborted=!1,a.cancelling=!1},_init:function(c,d){var f,h,i,j,e=this,g=e.$element;e.options=c,a.each(c,function(a,c){switch(a){case"minFileCount":case"maxFileCount":case"minFileSize":case"maxFileSize":case"maxFilePreviewSize":case"resizeImageQuality":case"resizeIfSizeMoreThan":case"progressUploadThreshold":case"initialPreviewCount":case"zoomModalHeight":case"minImageHeight":case"maxImageHeight":case"minImageWidth":case"maxImageWidth":e[a]=b.getNum(c);break;default:e[a]=c}}),e.rtl&&(j=e.previewZoomButtonIcons.prev,e.previewZoomButtonIcons.prev=e.previewZoomButtonIcons.next,e.previewZoomButtonIcons.next=j),d||e._cleanup(),e.$form=g.closest("form"),e._initTemplateDefaults(),e.uploadFileAttr=b.isEmpty(g.attr("name"))?"file_data":g.attr("name"),i=e._getLayoutTemplate("progress"),e.progressTemplate=i.replace("{class}",e.progressClass),e.progressCompleteTemplate=i.replace("{class}",e.progressCompleteClass),e.progressErrorTemplate=i.replace("{class}",e.progressErrorClass),e.dropZoneEnabled=b.hasDragDropSupport()&&e.dropZoneEnabled,e.isDisabled=g.attr("disabled")||g.attr("readonly"),e.isDisabled&&g.attr("disabled",!0),e.isAjaxUpload=b.hasFileUploadSupport()&&!b.isEmpty(e.uploadUrl),e.isClickable=e.browseOnZoneClick&&e.showPreview&&(e.isAjaxUpload&&e.dropZoneEnabled||!b.isEmpty(e.defaultPreviewContent)),e.slug="function"==typeof c.slugCallback?c.slugCallback:e._slugDefault,e.mainTemplate=e.showCaption?e._getLayoutTemplate("main1"):e._getLayoutTemplate("main2"),e.captionTemplate=e._getLayoutTemplate("caption"),e.previewGenericTemplate=e._getPreviewTemplate("generic"),!e.imageCanvas&&e.resizeImage&&(e.maxImageWidth||e.maxImageHeight)&&(e.imageCanvas=document.createElement("canvas"),e.imageCanvasContext=e.imageCanvas.getContext("2d")),b.isEmpty(g.attr("id"))&&g.attr("id",b.uniqId()),e.namespace=".fileinput_"+g.attr("id").replace(/-/g,"_"),void 0===e.$container?e.$container=e._createContainer():e._refreshContainer(),h=e.$container,e.$dropZone=h.find(".file-drop-zone"),e.$progress=h.find(".kv-upload-progress"),e.$btnUpload=h.find(".fileinput-upload"),e.$captionContainer=b.getElement(c,"elCaptionContainer",h.find(".file-caption")),e.$caption=b.getElement(c,"elCaptionText",h.find(".file-caption-name")),b.isEmpty(e.msgPlaceholder)||(f=g.attr("multiple")?e.filePlural:e.fileSingle,e.$caption.attr("placeholder",e.msgPlaceholder.replace("{files}",f))),e.$captionIcon=e.$captionContainer.find(".file-caption-icon"),e.mainClass.indexOf("input-group-lg")>-1?b.addCss(e.$captionIcon,"icon-lg"):e.$captionIcon.removeClass("icon-lg"),e.$previewContainer=b.getElement(c,"elPreviewContainer",h.find(".file-preview")),e.$preview=b.getElement(c,"elPreviewImage",h.find(".file-preview-thumbnails")),e.$previewStatus=b.getElement(c,"elPreviewStatus",h.find(".file-preview-status")),e.$errorContainer=b.getElement(c,"elErrorContainer",e.$previewContainer.find(".kv-fileinput-error")),e._validateDisabled(),b.isEmpty(e.msgErrorClass)||b.addCss(e.$errorContainer,e.msgErrorClass),d||(e.$errorContainer.hide(),e.previewInitId="preview-"+b.uniqId(),e._initPreviewCache(),e._initPreview(!0),e._initPreviewActions(),e._setFileDropZoneTitle(),e.$parent.hasClass("file-loading")&&(e.$container.insertBefore(e.$parent),e.$parent.remove())),g.attr("disabled")&&e.disable(),e._initZoom(),e.hideThumbnailContent&&b.addCss(e.$preview,"hide-content")},_initTemplateDefaults:function(){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,c=this;d='{preview}\n<div class="kv-upload-progress kv-hidden"></div><div class="clearfix"></div>\n<div class="input-group {class}">\n  {caption}\n<div class="input-group-btn">\n      {remove}\n      {cancel}\n      {upload}\n      {browse}\n    </div>\n</div>',e='{preview}\n<div class="kv-upload-progress kv-hidden"></div>\n<div class="clearfix"></div>\n{remove}\n{cancel}\n{upload}\n{browse}\n',f='<div class="file-preview {class}">\n    {close}    <div class="{dropClass}">\n    <div class="file-preview-thumbnails">\n    </div>\n    <div class="clearfix"></div>    <div class="file-preview-status text-center text-success"></div>\n    <div class="kv-fileinput-error"></div>\n    </div>\n</div>',h='<button type="button" class="close fileinput-remove">&times;</button>\n',g='<i class="glyphicon glyphicon-file"></i>',i='<div class="file-caption form-control {class}" tabindex="500">\n  <span class="file-caption-icon"></span>\n  <input class="file-caption-name" onkeydown="return false;" onpaste="return false;">\n</div>',j='<button type="{type}" tabindex="500" title="{title}" class="{css}" {status}>{icon} {label}</button>',k='<a href="{href}" tabindex="500" title="{title}" class="{css}" {status}>{icon} {label}</a>',l='<div tabindex="500" class="{css}" {status}>{icon} {label}</div>',m='<div id="'+b.MODAL_ID+'" class="file-zoom-dialog modal fade" '+'tabindex="-1" aria-labelledby="'+b.MODAL_ID+'Label"></div>',n='<div class="modal-dialog modal-lg{rtl}" role="document">\n  <div class="modal-content">\n    <div class="modal-header">\n      <h5 class="modal-title">{heading}</h5>\n      <span class="kv-zoom-title"></span>\n      <div class="kv-zoom-actions">{toggleheader}{fullscreen}{borderless}{close}</div>\n    </div>\n    <div class="modal-body">\n      <div class="floating-buttons"></div>\n      <div class="kv-zoom-body file-zoom-content {zoomFrameClass}"></div>\n{prev} {next}\n    </div>\n  </div>\n</div>\n',o='<div class="progress">\n    <div class="{class}" role="progressbar" aria-valuenow="{percent}" aria-valuemin="0" aria-valuemax="100" style="width:{percent}%;">\n        {status}\n     </div>\n</div>',p=" <samp>({sizeText})</samp>",q='<div class="file-thumbnail-footer">\n    <div class="file-footer-caption" title="{caption}">\n        <div class="file-caption-info">{caption}</div>\n        <div class="file-size-info">{size}</div>\n    </div>\n    {progress}\n{indicator}\n{actions}\n</div>',r='<div class="file-actions">\n    <div class="file-footer-buttons">\n        {download} {upload} {delete} {zoom} {other}    </div>\n</div>\n{drag}\n<div class="clearfix"></div>',s='<button type="button" class="kv-file-remove {removeClass}" title="{removeTitle}" {dataUrl}{dataKey}>{removeIcon}</button>\n',t='<button type="button" class="kv-file-upload {uploadClass}" title="{uploadTitle}">{uploadIcon}</button>',u='<a href="{downloadUrl}" class="{downloadClass}" title="{downloadTitle}" download="{caption}">{downloadIcon}</a>',v='<button type="button" class="kv-file-zoom {zoomClass}" title="{zoomTitle}">{zoomIcon}</button>',w='<span class="file-drag-handle {dragClass}" title="{dragTitle}">{dragIcon}</span>',x='<div class="file-upload-indicator" title="{indicatorTitle}">{indicator}</div>',y='<div class="file-preview-frame {frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-template="{template}"',z=y+'><div class="kv-file-content">\n',A=y+' title="{caption}"><div class="kv-file-content">\n',B="</div>{footer}\n</div>\n",C="{content}\n",D='<div class="kv-preview-data file-preview-html" title="{caption}" {style}>{data}</div>\n',E='<img src="{data}" class="file-preview-image kv-preview-data" title="{caption}" alt="{caption}" {style}>\n',F='<textarea class="kv-preview-data file-preview-text" title="{caption}" readonly {style}>{data}</textarea>\n',G='<video class="kv-preview-data file-preview-video" controls {style}>\n<source src="{data}" type="{type}">\n'+b.DEFAULT_PREVIEW+"\n</video>\n",H='<audio class="kv-preview-data file-preview-audio" controls {style}>\n<source src="{data}" type="{type}">\n'+b.DEFAULT_PREVIEW+"\n</audio>\n",I='<embed class="kv-preview-data file-preview-flash" src="{data}" type="application/x-shockwave-flash" {style}>\n',K='<embed class="kv-preview-data file-preview-pdf" src="{data}" type="application/pdf" {style}>\n',J='<object class="kv-preview-data file-preview-object file-object {typeCss}" data="{data}" type="{type}" {style}>\n<param name="movie" value="{caption}" />\n'+b.OBJECT_PARAMS+" "+b.DEFAULT_PREVIEW+"\n</object>\n",L='<div class="kv-preview-data file-preview-other-frame" {style}>\n'+b.DEFAULT_PREVIEW+"\n</div>\n",M='<div class="kv-zoom-cache" style="display:none">{zoomContent}</div>',N={width:"100%",height:"100%","min-height":"480px"},c.defaults={layoutTemplates:{main1:d,main2:e,preview:f,close:h,fileIcon:g,caption:i,modalMain:m,modal:n,progress:o,size:p,footer:q,indicator:x,actions:r,actionDelete:s,actionUpload:t,actionDownload:u,actionZoom:v,actionDrag:w,btnDefault:j,btnLink:k,btnBrowse:l,zoomCache:M},previewMarkupTags:{tagBefore1:z,tagBefore2:A,tagAfter:B},previewContentTemplates:{generic:C,html:D,image:E,text:F,video:G,audio:H,flash:I,object:J,pdf:K,other:L},allowedPreviewTypes:["image","html","text","video","audio","flash","pdf","object"],previewTemplates:{},previewSettings:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:{width:"213px",height:"160px"},text:{width:"213px",height:"160px"},video:{width:"213px",height:"160px"},audio:{width:"100%",height:"30px"},flash:{width:"213px",height:"160px"},object:{width:"213px",height:"160px"},pdf:{width:"213px",height:"160px"},other:{width:"213px",height:"160px"}},previewSettingsSmall:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:{width:"100%",height:"160px"},text:{width:"100%",height:"160px"},video:{width:"100%",height:"auto"},audio:{width:"100%",height:"30px"},flash:{width:"100%",height:"auto"},object:{width:"100%",height:"auto"},pdf:{width:"100%",height:"160px"},other:{width:"100%",height:"160px"}},previewZoomSettings:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:N,text:N,video:{width:"auto",height:"100%","max-width":"100%"},audio:{width:"100%",height:"30px"},flash:{width:"auto",height:"480px"},object:{width:"auto",height:"100%","max-width":"100%","min-height":"480px"},pdf:N,other:{width:"auto",height:"100%","min-height":"480px"}},fileTypeSettings:{image:function(a,c){return b.compare(a,"image.*")||b.compare(c,/\.(gif|png|jpe?g)$/i)},html:function(a,c){return b.compare(a,"text/html")||b.compare(c,/\.(htm|html)$/i)},text:function(a,c){return b.compare(a,"text.*")||b.compare(c,/\.(xml|javascript)$/i)||b.compare(c,/\.(txt|md|csv|nfo|ini|json|php|js|css)$/i)},video:function(a,c){return b.compare(a,"video.*")&&(b.compare(a,/(ogg|mp4|mp?g|mov|webm|3gp)$/i)||b.compare(c,/\.(og?|mp4|webm|mp?g|mov|3gp)$/i))},audio:function(a,c){return b.compare(a,"audio.*")&&(b.compare(c,/(ogg|mp3|mp?g|wav)$/i)||b.compare(c,/\.(og?|mp3|mp?g|wav)$/i))},flash:function(a,c){return b.compare(a,"application/x-shockwave-flash",!0)||b.compare(c,/\.(swf)$/i)},pdf:function(a,c){return b.compare(a,"application/pdf",!0)||b.compare(c,/\.(pdf)$/i)},object:function(){return!0},other:function(){return!0}},fileActionSettings:{showRemove:!0,showUpload:!0,showDownload:!0,showZoom:!0,showDrag:!0,removeIcon:'<i class="glyphicon glyphicon-trash"></i>',removeClass:"btn btn-kv btn-default btn-outline-secondary",removeErrorClass:"btn btn-kv btn-danger",removeTitle:"Remove file",uploadIcon:'<i class="glyphicon glyphicon-upload"></i>',uploadClass:"btn btn-kv btn-default btn-outline-secondary",uploadTitle:"Upload file",uploadRetryIcon:'<i class="glyphicon glyphicon-repeat"></i>',uploadRetryTitle:"Retry upload",downloadIcon:'<i class="glyphicon glyphicon-download"></i>',downloadClass:"btn btn-kv btn-default btn-outline-secondary",downloadTitle:"Download file",zoomIcon:'<i class="glyphicon glyphicon-zoom-in"></i>',zoomClass:"btn btn-kv btn-default btn-outline-secondary",zoomTitle:"View Details",dragIcon:'<i class="glyphicon glyphicon-move"></i>',dragClass:"text-info",dragTitle:"Move / Rearrange",dragSettings:{},indicatorNew:'<i class="glyphicon glyphicon-plus-sign text-warning"></i>',indicatorSuccess:'<i class="glyphicon glyphicon-ok-sign text-success"></i>',indicatorError:'<i class="glyphicon glyphicon-exclamation-sign text-danger"></i>',indicatorLoading:'<i class="glyphicon glyphicon-hourglass text-muted"></i>',indicatorNewTitle:"Not uploaded yet",indicatorSuccessTitle:"Uploaded",indicatorErrorTitle:"Upload Error",indicatorLoadingTitle:"Uploading ..."}},a.each(c.defaults,function(b,d){return"allowedPreviewTypes"===b?(void 0===c.allowedPreviewTypes&&(c.allowedPreviewTypes=d),void 0):(c[b]=a.extend(!0,{},d,c[b]),void 0)}),c._initPreviewTemplates()},_initPreviewTemplates:function(){var f,c=this,d=c.defaults,e=c.previewMarkupTags,g=e.tagAfter;a.each(d.previewContentTemplates,function(a,d){b.isEmpty(c.previewTemplates[a])&&(f=e.tagBefore2,("generic"===a||"image"===a||"html"===a||"text"===a)&&(f=e.tagBefore1),c.previewTemplates[a]=f+d+g)})},_initPreviewCache:function(){var c=this;c.previewCache={data:{},init:function(){var a=c.initialPreview;a.length>0&&!b.isArray(a)&&(a=a.split(c.initialPreviewDelimiter)),c.previewCache.data={content:a,config:c.initialPreviewConfig,tags:c.initialPreviewThumbTags}},count:function(){return c.previewCache.data&&c.previewCache.data.content?c.previewCache.data.content.length:0},get:function(d,e){var k,l,m,n,o,p,q,f="init_"+d,g=c.previewCache.data,h=g.config[d],i=g.content[d],j=c.previewInitId+"-"+f,r=b.ifSet("previewAsData",h,c.initialPreviewAsData),s=function(a,d,e,f,g,h,i,j,k){return j=" file-preview-initial "+b.SORT_CSS+(j?" "+j:""),c._generatePreviewTemplate(a,d,e,f,g,!1,null,j,h,i,k)};return i?(e=void 0===e?!0:e,m=b.ifSet("type",h,c.initialPreviewFileType||"generic"),o=b.ifSet("filename",h,b.ifSet("caption",h)),p=b.ifSet("filetype",h,m),n=c.previewCache.footer(d,e,h&&h.size||null),q=b.ifSet("frameClass",h),k=r?s(m,i,o,p,j,n,f,q):s("generic",i,o,p,j,n,f,q,m).setTokens({content:g.content[d]}),g.tags.length&&g.tags[d]&&(k=b.replaceTags(k,g.tags[d])),b.isEmpty(h)||b.isEmpty(h.frameAttr)||(l=a(document.createElement("div")).html(k),l.find(".file-preview-initial").attr(h.frameAttr),k=l.html(),l.remove()),k):""},add:function(a,d,e,f){var h,g=c.previewCache.data;return b.isArray(a)||(a=a.split(c.initialPreviewDelimiter)),f?(h=g.content.push(a)-1,g.config[h]=d,g.tags[h]=e):(h=a.length-1,g.content=a,g.config=d,g.tags=e),c.previewCache.data=g,h},set:function(a,d,e,f){var h,i,g=c.previewCache.data;if(a&&a.length&&(b.isArray(a)||(a=a.split(c.initialPreviewDelimiter)),i=a.filter(function(a){return null!==a}),i.length)){if(void 0===g.content&&(g.content=[]),void 0===g.config&&(g.config=[]),void 0===g.tags&&(g.tags=[]),f){for(h=0;h<a.length;h++)a[h]&&g.content.push(a[h]);for(h=0;h<d.length;h++)d[h]&&g.config.push(d[h]);for(h=0;h<e.length;h++)e[h]&&g.tags.push(e[h])}else g.content=a,g.config=d,g.tags=e;c.previewCache.data=g}},unset:function(a){var b=c.previewCache.count();if(b){if(1===b)return c.previewCache.data.content=[],c.previewCache.data.config=[],c.previewCache.data.tags=[],c.initialPreview=[],c.initialPreviewConfig=[],c.initialPreviewThumbTags=[],void 0;c.previewCache.data.content.splice(a,1),c.previewCache.data.config.splice(a,1),c.previewCache.data.tags.splice(a,1)}},out:function(){var b,e,a="",d=c.previewCache.count();if(0===d)return{content:"",caption:""};for(e=0;d>e;e++)a+=c.previewCache.get(e);return b=c._getMsgSelected(d),{content:a,caption:b}},footer:function(a,d,e){var i,g,h,j,k,l,m,n,o,p,q,r,s,t,u,v,f=c.previewCache.data||{};return b.isEmpty(f.content)?"":((b.isEmpty(f.config)||b.isEmpty(f.config[a]))&&(f.config[a]={}),d=void 0===d?!0:d,g=f.config[a],h=b.ifSet("caption",g),j=b.ifSet("width",g,"auto"),k=b.ifSet("url",g,!1),l=b.ifSet("key",g,null),m=c.fileActionSettings,n=c.initialPreviewShowDelete||!1,o=g.downloadUrl||c.initialPreviewDownloadUrl||"",p=g.filename||g.caption||"",q=!!o,r=b.ifSet("showDelete",g,b.ifSet("showDelete",m,n)),s=b.ifSet("showDownload",g,b.ifSet("showDownload",m,q)),t=b.ifSet("showZoom",g,b.ifSet("showZoom",m,!0)),u=b.ifSet("showDrag",g,b.ifSet("showDrag",m,!0)),v=k===!1&&d,s=s&&g.downloadUrl!==!1&&!!o,i=c._renderFileActions(!1,s,r,t,u,v,k,l,!0,o,p),c._getLayoutTemplate("footer").setTokens({progress:c._renderThumbProgress(),actions:i,caption:h,size:c._getSize(e),width:j,indicator:""}))}},c.previewCache.init()},_handler:function(a,b,c){var d=this,e=d.namespace,f=b.split(" ").join(e+" ")+e;a&&a.length&&a.off(f).on(f,c)},_log:function(a){var b=this,c=b.$element.attr("id");c&&(a='"'+c+'": '+a),"undefined"!=typeof window.console.log?window.console.log(a):window.alert(a)},_validate:function(){var a=this,b="file"===a.$element.attr("type");return b||a._log('The input "type" must be set to "file" for initializing the "bootstrap-fileinput" plugin.'),b},_errorsExist:function(){var c,b=this,d=b.$errorContainer.find("li");return d.length?!0:(c=a(document.createElement("div")).html(b.$errorContainer.html()),c.find(".kv-error-close").remove(),c.find("ul").remove(),!!a.trim(c.text()).length)},_errorHandler:function(a,b){var c=this,d=a.target.error,e=function(a){c._showError(a.replace("{name}",b))};d.code===d.NOT_FOUND_ERR?e(c.msgFileNotFound):d.code===d.SECURITY_ERR?e(c.msgFileSecured):d.code===d.NOT_READABLE_ERR?e(c.msgFileNotReadable):d.code===d.ABORT_ERR?e(c.msgFilePreviewAborted):e(c.msgFilePreviewError)},_addError:function(a){var b=this,c=b.$errorContainer;a&&c.length&&(c.html(b.errorCloseButton+a),b._handler(c.find(".kv-error-close"),"click",function(){c.fadeOut("slow")}))},_setValidationError:function(a){var c=this;a=(a?a+" ":"")+"has-error",c.$container.removeClass(a).addClass("has-error"),b.addCss(c.$captionContainer,"is-invalid")},_resetErrors:function(a){var b=this,c=b.$errorContainer;b.isError=!1,b.$container.removeClass("has-error"),b.$captionContainer.removeClass("is-invalid"),c.html(""),a?c.fadeOut("slow"):c.hide()},_showFolderError:function(a){var d,b=this,c=b.$errorContainer;a&&(d=b.msgFoldersNotAllowed.replace("{n}",a),b._addError(d),b._setValidationError(),c.fadeIn(800),b._raise("filefoldererror",[a,d]))},_showUploadError:function(a,b,c){var d=this,e=d.$errorContainer,f=c||"fileuploaderror",g=b&&b.id?'<li data-file-id="'+b.id+'">'+a+"</li>":"<li>"+a+"</li>";return 0===e.find("ul").length?d._addError("<ul>"+g+"</ul>"):e.find("ul").append(g),e.fadeIn(800),d._raise(f,[b,a]),d._setValidationError("file-input-new"),!0},_showError:function(a,b,c){var d=this,e=d.$errorContainer,f=c||"fileerror";return b=b||{},b.reader=d.reader,d._addError(a),e.fadeIn(800),d._raise(f,[b,a]),d.isAjaxUpload||d._clearFileInput(),d._setValidationError("file-input-new"),d.$btnUpload.attr("disabled",!0),!0},_noFilesError:function(a){var b=this,c=b.minFileCount>1?b.filePlural:b.fileSingle,d=b.msgFilesTooLess.replace("{n}",b.minFileCount).replace("{files}",c),e=b.$errorContainer;b._addError(d),b.isError=!0,b._updateFileDetails(0),e.fadeIn(800),b._raise("fileerror",[a,d]),b._clearFileInput(),b._setValidationError()},_parseError:function(b,c,d,e){var h,f=this,g=a.trim(d+""),i=void 0!==c.responseJSON&&void 0!==c.responseJSON.error?c.responseJSON.error:c.responseText;return f.cancelling&&f.msgUploadAborted&&(g=f.msgUploadAborted),f.showAjaxErrorDetails&&i&&(i=a.trim(i.replace(/\n\s*\n/g,"\n")),h=i.length?"<pre>"+i+"</pre>":"",g+=g?h:i),g||(g=f.msgAjaxError.replace("{operation}",b)),f.cancelling=!1,e?"<b>"+e+": </b>"+g:g},_parseFileType:function(a,c){var e,f,g,h,d=this,i=d.allowedPreviewTypes||[];if("application/text-plain"===a)return"text";for(h=0;h<i.length;h++)if(g=i[h],e=d.fileTypeSettings[g],f=e(a,c)?g:"",!b.isEmpty(f))return f;return"other"},_getPreviewIcon:function(b){var d,c=this,e=null;return b&&b.indexOf(".")>-1&&(d=b.split(".").pop(),c.previewFileIconSettings&&(e=c.previewFileIconSettings[d]||c.previewFileIconSettings[d.toLowerCase()]||null),c.previewFileExtSettings&&a.each(c.previewFileExtSettings,function(a,b){return c.previewFileIconSettings[a]&&b(d)?(e=c.previewFileIconSettings[a],void 0):void 0})),e},_parseFilePreviewIcon:function(a,b){var c=this,d=c._getPreviewIcon(b)||c.previewFileIcon,e=a;return e.indexOf("{previewFileIcon}")>-1&&(e=e.setTokens({previewFileIconClass:c.previewFileIconClass,previewFileIcon:d})),e},_raise:function(b,c){var d=this,e=a.Event(b);if(void 0!==c?d.$element.trigger(e,c):d.$element.trigger(e),e.isDefaultPrevented()||e.result===!1)return!1;switch(b){case"filebatchuploadcomplete":case"filebatchuploadsuccess":case"fileuploaded":case"fileclear":case"filecleared":case"filereset":case"fileerror":case"filefoldererror":case"fileuploaderror":case"filebatchuploaderror":case"filedeleteerror":case"filecustomerror":case"filesuccessremove":break;default:d.ajaxAborted||(d.ajaxAborted=e.result)}return!0},_listenFullScreen:function(a){var d,e,b=this,c=b.$modal;c&&c.length&&(d=c&&c.find(".btn-fullscreen"),e=c&&c.find(".btn-borderless"),d.length&&e.length&&(d.removeClass("active").attr("aria-pressed","false"),e.removeClass("active").attr("aria-pressed","false"),a?d.addClass("active").attr("aria-pressed","true"):e.addClass("active").attr("aria-pressed","true"),c.hasClass("file-zoom-fullscreen")?b._maximizeZoomDialog():a?b._maximizeZoomDialog():e.removeClass("active").attr("aria-pressed","false")))},_listen:function(){var g,c=this,d=c.$element,e=c.$form,f=c.$container;c._handler(d,"change",a.proxy(c._change,c)),c.showBrowse&&c._handler(c.$btnFile,"click",a.proxy(c._browse,c)),c._handler(f.find(".fileinput-remove:not([disabled])"),"click",a.proxy(c.clear,c)),c._handler(f.find(".fileinput-cancel"),"click",a.proxy(c.cancel,c)),c._initDragDrop(),c._handler(e,"reset",a.proxy(c.clear,c)),c.isAjaxUpload||c._handler(e,"submit",a.proxy(c._submitForm,c)),c._handler(c.$container.find(".fileinput-upload"),"click",a.proxy(c._uploadClick,c)),c._handler(a(window),"resize",function(){c._listenFullScreen(screen.width===window.innerWidth&&screen.height===window.innerHeight)}),g="webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",c._handler(a(document),g,function(){c._listenFullScreen(b.checkFullScreen())}),c._autoFitContent(),c._initClickable()},_autoFitContent:function(){var e,b=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,c=this,d=400>b?c.previewSettingsSmall||c.defaults.previewSettingsSmall:c.previewSettings||c.defaults.previewSettings;a.each(d,function(a,b){e=".file-preview-frame .file-preview-"+a,c.$preview.find(e+".kv-preview-data,"+e+" .kv-preview-data").css(b)})},_initClickable:function(){var d,c=this;c.isClickable&&(d=c.isAjaxUpload?c.$dropZone:c.$preview.find(".file-default-preview"),b.addCss(d,"clickable"),d.attr("tabindex",-1),c._handler(d,"click",function(b){var e=a(b.target);(!e.parents(".file-preview-thumbnails").length||e.parents(".file-default-preview").length)&&(c.$element.trigger("click"),d.blur())}))},_initDragDrop:function(){var b=this,c=b.$dropZone;b.isAjaxUpload&&b.dropZoneEnabled&&b.showPreview&&(b._handler(c,"dragenter dragover",a.proxy(b._zoneDragEnter,b)),b._handler(c,"dragleave",a.proxy(b._zoneDragLeave,b)),b._handler(c,"drop",a.proxy(b._zoneDrop,b)),b._handler(a(document),"dragenter dragover drop",b._zoneDragDropInit))},_zoneDragDropInit:function(a){a.stopPropagation(),a.preventDefault()},_zoneDragEnter:function(c){var d=this,e=a.inArray("Files",c.originalEvent.dataTransfer.types)>-1;return d._zoneDragDropInit(c),d.isDisabled||!e?(c.originalEvent.dataTransfer.effectAllowed="none",c.originalEvent.dataTransfer.dropEffect="none",void 0):(b.addCss(d.$dropZone,"file-highlighted"),void 0)},_zoneDragLeave:function(a){var b=this;b._zoneDragDropInit(a),b.isDisabled||b.$dropZone.removeClass("file-highlighted")},_zoneDrop:function(a){var c=this;a.preventDefault(),c.isDisabled||b.isEmpty(a.originalEvent.dataTransfer.files)||(c._change(a,"dragdrop"),c.$dropZone.removeClass("file-highlighted"))},_uploadClick:function(a){var e,c=this,d=c.$container.find(".fileinput-upload"),f=!d.hasClass("disabled")&&b.isEmpty(d.attr("disabled"));if(!a||!a.isDefaultPrevented()){if(!c.isAjaxUpload)return f&&"submit"!==d.attr("type")&&(e=d.closest("form"),e.length&&e.trigger("submit"),a.preventDefault()),void 0;a.preventDefault(),f&&c.upload()}},_submitForm:function(){var a=this;return a._isFileSelectionValid()&&!a._abort({})},_clearPreview:function(){var c=this,d=c.$preview,e=c.showUploadedThumbs?c.getFrames(":not(.file-preview-success)"):c.getFrames();e.each(function(){var c=a(this);c.remove(),b.cleanZoomCache(d.find("#zoom-"+c.attr("id")))}),c.getFrames().length&&c.showPreview||c._resetUpload(),c._validateDefaultPreview()
},_initSortable:function(){var e,c=this,d=c.$preview,f="."+b.SORT_CSS;window.KvSortable&&0!==d.find(f).length&&(e={handle:".drag-handle-init",dataIdAttr:"data-preview-id",scroll:!1,draggable:f,onSort:function(d){var g,h,i,e=d.oldIndex,f=d.newIndex;for(c.initialPreview=b.moveArray(c.initialPreview,e,f),c.initialPreviewConfig=b.moveArray(c.initialPreviewConfig,e,f),c.previewCache.init(),i=0;i<c.initialPreviewConfig.length;i++)null!==c.initialPreviewConfig[i]&&(g=c.initialPreviewConfig[i].key,h=a(".kv-file-remove[data-key='"+g+"']").closest(b.FRAMES),h.attr("data-fileindex","init_"+i).attr("data-fileindex","init_"+i));c._raise("filesorted",{previewId:a(d.item).attr("id"),oldIndex:e,newIndex:f,stack:c.initialPreviewConfig})}},d.data("kvsortable")&&d.kvsortable("destroy"),a.extend(!0,e,c.fileActionSettings.dragSettings),d.kvsortable(e))},_setPreviewContent:function(a){var b=this;b.$preview.html(a),b._autoFitContent()},_initPreview:function(a){var e,c=this,d=c.initialCaption||"";return c.previewCache.count()?(e=c.previewCache.out(),d=a&&c.initialCaption?c.initialCaption:e.caption,c._setPreviewContent(e.content),c._setInitThumbAttr(),c._setCaption(d),c._initSortable(),b.isEmpty(e.content)||c.$container.removeClass("file-input-new"),void 0):(c._clearPreview(),a?c._setCaption(d):c._initCaption(),void 0)},_getZoomButton:function(a){var b=this,c=b.previewZoomButtonIcons[a],d=b.previewZoomButtonClasses[a],e=' title="'+(b.previewZoomButtonTitles[a]||"")+'" ',f=e+("close"===a?' data-dismiss="modal" aria-hidden="true"':"");return("fullscreen"===a||"borderless"===a||"toggleheader"===a)&&(f+=' data-toggle="button" aria-pressed="false" autocomplete="off"'),'<button type="button" class="'+d+" btn-"+a+'"'+f+">"+c+"</button>"},_getModalContent:function(){var a=this;return a._getLayoutTemplate("modal").setTokens({rtl:a.rtl?" kv-rtl":"",zoomFrameClass:a.frameClass,heading:a.msgZoomModalHeading,prev:a._getZoomButton("prev"),next:a._getZoomButton("next"),toggleheader:a._getZoomButton("toggleheader"),fullscreen:a._getZoomButton("fullscreen"),borderless:a._getZoomButton("borderless"),close:a._getZoomButton("close")})},_listenModalEvent:function(a){var c=this,d=c.$modal,e=function(a){return{sourceEvent:a,previewId:d.data("previewId"),modal:d}};d.on(a+".bs.modal",function(f){var g=d.find(".btn-fullscreen"),h=d.find(".btn-borderless");c._raise("filezoom"+a,e(f)),"shown"===a&&(h.removeClass("active").attr("aria-pressed","false"),g.removeClass("active").attr("aria-pressed","false"),d.hasClass("file-zoom-fullscreen")&&(c._maximizeZoomDialog(),b.checkFullScreen()?g.addClass("active").attr("aria-pressed","true"):h.addClass("active").attr("aria-pressed","true")))})},_initZoom:function(){var d,c=this,e=c._getLayoutTemplate("modalMain"),f="#"+b.MODAL_ID;c.showPreview&&(c.$modal=a(f),c.$modal&&c.$modal.length||(d=a(document.createElement("div")).html(e).insertAfter(c.$container),c.$modal=a(f).insertBefore(d),d.remove()),b.initModal(c.$modal),c.$modal.html(c._getModalContent()),a.each(b.MODAL_EVENTS,function(a,b){c._listenModalEvent(b)}))},_initZoomButtons:function(){var d,e,b=this,c=b.$modal.data("previewId")||"",f=b.getFrames().toArray(),g=f.length,h=b.$modal.find(".btn-prev"),i=b.$modal.find(".btn-next");return f.length<2?(h.hide(),i.hide(),void 0):(h.show(),i.show(),g&&(d=a(f[0]),e=a(f[g-1]),h.removeAttr("disabled"),i.removeAttr("disabled"),d.length&&d.attr("id")===c&&h.attr("disabled",!0),e.length&&e.attr("id")===c&&i.attr("disabled",!0)),void 0)},_maximizeZoomDialog:function(){var b=this,c=b.$modal,d=c.find(".modal-header:visible"),e=c.find(".modal-footer:visible"),f=c.find(".modal-body"),g=a(window).height(),h=0;c.addClass("file-zoom-fullscreen"),d&&d.length&&(g-=d.outerHeight(!0)),e&&e.length&&(g-=e.outerHeight(!0)),f&&f.length&&(h=f.outerHeight(!0)-f.height(),g-=h),c.find(".kv-zoom-body").height(g)},_resizeZoomDialog:function(a){var c=this,d=c.$modal,e=d.find(".btn-fullscreen"),f=d.find(".btn-borderless");if(d.hasClass("file-zoom-fullscreen"))b.toggleFullScreen(!1),a?e.hasClass("active")||(d.removeClass("file-zoom-fullscreen"),c._resizeZoomDialog(!0),f.hasClass("active")&&f.removeClass("active").attr("aria-pressed","false")):e.hasClass("active")?e.removeClass("active").attr("aria-pressed","false"):(d.removeClass("file-zoom-fullscreen"),c.$modal.find(".kv-zoom-body").css("height",c.zoomModalHeight));else{if(!a)return c._maximizeZoomDialog(),void 0;b.toggleFullScreen(!0)}d.focus()},_setZoomContent:function(c,d){var j,k,l,q,x,e=this,m=c.attr("id"),n=e.$modal,o=n.find(".btn-prev"),p=n.find(".btn-next"),r=n.find(".btn-fullscreen"),s=n.find(".btn-borderless"),v=n.find(".btn-toggleheader"),w=e.$preview.find("#zoom-"+m),g=w.attr("data-template")||"generic",f=w.find(".kv-file-content"),h=f.length?f.html():"",t=c.data("caption")||"",u=c.data("size")||"",i=t+" "+u;n.find(".kv-zoom-title").attr("title",a("<div/>").html(i).text()).html(i),j=n.find(".kv-zoom-body"),n.removeClass("kv-single-content"),d?(q=j.addClass("file-thumb-loading").clone().insertAfter(j),j.html(h).hide(),q.fadeOut("fast",function(){j.fadeIn("fast",function(){j.removeClass("file-thumb-loading")}),q.remove()})):j.html(h),l=e.previewZoomSettings[g],l&&(k=j.find(".kv-preview-data"),b.addCss(k,"file-zoom-detail"),a.each(l,function(a,b){k.css(a,b),(k.attr("width")&&"width"===a||k.attr("height")&&"height"===a)&&k.removeAttr(a)})),n.data("previewId",m),x=j.find("img"),x.length&&b.adjustOrientedImage(x,!0),e._handler(o,"click",function(){e._zoomSlideShow("prev",m)}),e._handler(p,"click",function(){e._zoomSlideShow("next",m)}),e._handler(r,"click",function(){e._resizeZoomDialog(!0)}),e._handler(s,"click",function(){e._resizeZoomDialog(!1)}),e._handler(v,"click",function(){var c,a=n.find(".modal-header"),b=n.find(".modal-body .floating-buttons"),d=a.find(".kv-zoom-actions"),f=function(b){var c=e.$modal.find(".kv-zoom-body"),d=e.zoomModalHeight;n.hasClass("file-zoom-fullscreen")&&(d=c.outerHeight(!0),b||(d-=a.outerHeight(!0))),c.css("height",b?d+b:d)};a.is(":visible")?(c=a.outerHeight(!0),a.slideUp("slow",function(){d.find(".btn").appendTo(b),f(c)})):(b.find(".btn").appendTo(d),a.slideDown("slow",function(){f()})),n.focus()}),e._handler(n,"keydown",function(a){var b=a.which||a.keyCode;37!==b||o.attr("disabled")||e._zoomSlideShow("prev",m),39!==b||p.attr("disabled")||e._zoomSlideShow("next",m)})},_zoomPreview:function(a){var d,c=this,e=c.$modal;if(!a.length)throw"Cannot zoom to detailed preview!";b.initModal(e),e.html(c._getModalContent()),d=a.closest(b.FRAMES),c._setZoomContent(d),e.modal("show"),c._initZoomButtons()},_zoomSlideShow:function(b,c){var f,g,j,d=this,e=d.$modal.find(".kv-zoom-actions .btn-"+b),h=d.getFrames().toArray(),i=h.length;if(!e.attr("disabled")){for(g=0;i>g;g++)if(a(h[g]).attr("id")===c){j="prev"===b?g-1:g+1;break}0>j||j>=i||!h[j]||(f=a(h[j]),f.length&&d._setZoomContent(f,!0),d._initZoomButtons(),d._raise("filezoom"+b,{previewId:c,modal:d.$modal}))}},_initZoomButton:function(){var b=this;b.$preview.find(".kv-file-zoom").each(function(){var c=a(this);b._handler(c,"click",function(){b._zoomPreview(c)})})},_clearObjects:function(b){b.find("video audio").each(function(){this.pause(),a(this).remove()}),b.find("img object div").each(function(){a(this).remove()})},_clearFileInput:function(){var e,f,g,c=this,d=c.$element;c.fileInputCleared=!0,b.isEmpty(d.val())||(c.isIE9||c.isIE10?(e=d.closest("form"),f=a(document.createElement("form")),g=a(document.createElement("div")),d.before(g),e.length?e.after(f):g.after(f),f.append(d).trigger("reset"),g.before(d).remove(),f.remove()):d.val(""))},_resetUpload:function(){var a=this;a.uploadCache={content:[],config:[],tags:[],append:!0},a.uploadCount=0,a.uploadStatus={},a.uploadLog=[],a.uploadAsyncCount=0,a.loadedImages=[],a.totalImagesCount=0,a.$btnUpload.removeAttr("disabled"),a._setProgress(0),a.$progress.hide(),a._resetErrors(!1),a.ajaxAborted=!1,a.ajaxRequests=[],a._resetCanvas(),a.cacheInitialPreview={},a.overwriteInitial&&(a.initialPreview=[],a.initialPreviewConfig=[],a.initialPreviewThumbTags=[],a.previewCache.data={content:[],config:[],tags:[]})},_resetCanvas:function(){var a=this;a.canvas&&a.imageCanvasContext&&a.imageCanvasContext.clearRect(0,0,a.canvas.width,a.canvas.height)},_hasInitialPreview:function(){var a=this;return!a.overwriteInitial&&a.previewCache.count()},_resetPreview:function(){var b,c,a=this;a.previewCache.count()?(b=a.previewCache.out(),a._setPreviewContent(b.content),a._setInitThumbAttr(),c=a.initialCaption?a.initialCaption:b.caption,a._setCaption(c)):(a._clearPreview(),a._initCaption()),a.showPreview&&(a._initZoom(),a._initSortable())},_clearDefaultPreview:function(){var a=this;a.$preview.find(".file-default-preview").remove()},_validateDefaultPreview:function(){var a=this;a.showPreview&&!b.isEmpty(a.defaultPreviewContent)&&(a._setPreviewContent('<div class="file-default-preview">'+a.defaultPreviewContent+"</div>"),a.$container.removeClass("file-input-new"),a._initClickable())},_resetPreviewThumbs:function(a){var c,b=this;return a?(b._clearPreview(),b.clearStack(),void 0):(b._hasInitialPreview()?(c=b.previewCache.out(),b._setPreviewContent(c.content),b._setInitThumbAttr(),b._setCaption(c.caption),b._initPreviewActions()):b._clearPreview(),void 0)},_getLayoutTemplate:function(a){var c=this,d=c.layoutTemplates[a];return b.isEmpty(c.customLayoutTags)?d:b.replaceTags(d,c.customLayoutTags)},_getPreviewTemplate:function(a){var c=this,d=c.previewTemplates[a];return b.isEmpty(c.customPreviewTags)?d:b.replaceTags(d,c.customPreviewTags)},_getOutData:function(a,b,c){var d=this;return a=a||{},b=b||{},c=c||d.filestack.slice(0)||{},{form:d.formdata,files:c,filenames:d.filenames,filescount:d.getFilesCount(),extra:d._getExtraData(),response:b,reader:d.reader,jqXHR:a}},_getMsgSelected:function(a){var b=this,c=1===a?b.fileSingle:b.filePlural;return a>0?b.msgSelected.replace("{n}",a).replace("{files}",c):b.msgNoFilesSelected},_getFrame:function(b){var c=this,d=a("#"+b);return d.length?d:(c._log('Invalid thumb frame with id: "'+b+'".'),null)},_getThumbs:function(a){return a=a||"",this.getFrames(":not(.file-preview-initial)"+a)},_getExtraData:function(a,b){var c=this,d=c.uploadExtraData;return"function"==typeof c.uploadExtraData&&(d=c.uploadExtraData(a,b)),d},_initXhr:function(a,b,c){var d=this;return a.upload&&a.upload.addEventListener("progress",function(a){var e=0,f=a.total,g=a.loaded||a.position;a.lengthComputable&&(e=Math.floor(100*(g/f))),b?d._setAsyncUploadStatus(b,e,c):d._setProgress(e)},!1),a},_mergeAjaxCallback:function(a,b,c){var g,d=this,e=d.ajaxSettings,f=d.mergeAjaxCallbacks;"delete"===c&&(e=d.ajaxDeleteSettings,f=d.mergeAjaxDeleteCallbacks),g=e[a],e[a]=f&&"function"==typeof g?"before"===f?function(){g.apply(this,arguments),b.apply(this,arguments)}:function(){b.apply(this,arguments),g.apply(this,arguments)}:b,"delete"===c?d.ajaxDeleteSettings=e:d.ajaxSettings=e},_ajaxSubmit:function(b,c,d,e,f,g){var i,h=this;h._raise("filepreajax",[f,g])&&(h._uploadExtra(f,g),h._mergeAjaxCallback("beforeSend",b),h._mergeAjaxCallback("success",c),h._mergeAjaxCallback("complete",d),h._mergeAjaxCallback("error",e),i=a.extend(!0,{},{xhr:function(){var b=a.ajaxSettings.xhr();return h._initXhr(b,f,h.getFileStack().length)},url:g&&h.uploadUrlThumb?h.uploadUrlThumb:h.uploadUrl,type:"POST",dataType:"json",data:h.formdata,cache:!1,processData:!1,contentType:!1},h.ajaxSettings),h.ajaxRequests.push(a.ajax(i)))},_mergeArray:function(a,c){var d=this,e=b.cleanArray(d[a]),f=b.cleanArray(c);d[a]=e.concat(f)},_initUploadSuccess:function(c,d,e){var g,h,i,j,k,l,m,n,o,f=this;f.showPreview&&"object"==typeof c&&!a.isEmptyObject(c)&&void 0!==c.initialPreview&&c.initialPreview.length>0&&(f.hasInitData=!0,l=c.initialPreview||[],m=c.initialPreviewConfig||[],n=c.initialPreviewThumbTags||[],g=void 0===c.append||c.append,l.length>0&&!b.isArray(l)&&(l=l.split(f.initialPreviewDelimiter)),f._mergeArray("initialPreview",l),f._mergeArray("initialPreviewConfig",m),f._mergeArray("initialPreviewThumbTags",n),void 0!==d?e?(o=d.attr("data-fileindex"),f.uploadCache.content[o]=l[0],f.uploadCache.config[o]=m[0]||[],f.uploadCache.tags[o]=n[0]||[],f.uploadCache.append=g):(i=f.previewCache.add(l,m[0],n[0],g),h=f.previewCache.get(i,!1),j=a(document.createElement("div")).html(h).hide().insertAfter(d),k=j.find(".kv-zoom-cache"),k&&k.length&&k.insertAfter(d),d.fadeOut("slow",function(){var a=j.find(".file-preview-frame");a&&a.length&&a.insertBefore(d).fadeIn("slow").css("display:inline-block"),f._initPreviewActions(),f._clearFileInput(),b.cleanZoomCache(f.$preview.find("#zoom-"+d.attr("id"))),d.remove(),j.remove(),f._initSortable()})):(f.previewCache.set(l,m,n,g),f._initPreview(),f._initPreviewActions()))},_initSuccessThumbs:function(){var c=this;c.showPreview&&c._getThumbs(b.FRAMES+".file-preview-success").each(function(){var d=a(this),e=c.$preview,f=d.find(".kv-file-remove");f.removeAttr("disabled"),c._handler(f,"click",function(){var a=d.attr("id"),f=c._raise("filesuccessremove",[a,d.attr("data-fileindex")]);b.cleanMemory(d),f!==!1&&d.fadeOut("slow",function(){b.cleanZoomCache(e.find("#zoom-"+a)),d.remove(),c.getFrames().length||c.reset()})})})},_checkAsyncComplete:function(){var c,d,b=this;for(d=0;d<b.filestack.length;d++)if(b.filestack[d]&&(c=b.previewInitId+"-"+d,-1===a.inArray(c,b.uploadLog)))return!1;return b.uploadAsyncCount===b.uploadLog.length},_uploadExtra:function(b,c){var d=this,e=d._getExtraData(b,c);0!==e.length&&a.each(e,function(a,b){d.formdata.append(a,b)})},_uploadSingle:function(c,d){var h,j,k,l,m,o,q,r,s,t,u,e=this,f=e.getFileStack().length,g=new FormData,i=e.previewInitId+"-"+c,n=e.filestack.length>0||!a.isEmptyObject(e.uploadExtraData),p=a("#"+i).find(".file-thumb-progress"),v={id:i,index:c};e.formdata=g,e.showPreview&&(j=a("#"+i+":not(.file-preview-initial)"),l=j.find(".kv-file-upload"),m=j.find(".kv-file-remove"),p.show()),0===f||!n||l&&l.hasClass("disabled")||e._abort(v)||(u=function(a,b){o||e.updateStack(a,void 0),e.uploadLog.push(b),e._checkAsyncComplete()&&(e.fileBatchCompleted=!0)},k=function(){var c,d,f,a=e.uploadCache,g=0,h=e.cacheInitialPreview;e.fileBatchCompleted&&(h&&h.content&&(g=h.content.length),setTimeout(function(){var i=0===e.getFileStack(!0).length;if(e.showPreview){if(e.previewCache.set(a.content,a.config,a.tags,a.append),g){for(d=0;d<a.content.length;d++)f=d+g,h.content[f]=a.content[d],h.config.length&&(h.config[f]=a.config[d]),h.tags.length&&(h.tags[f]=a.tags[d]);e.initialPreview=b.cleanArray(h.content),e.initialPreviewConfig=b.cleanArray(h.config),e.initialPreviewThumbTags=b.cleanArray(h.tags)}else e.initialPreview=a.content,e.initialPreviewConfig=a.config,e.initialPreviewThumbTags=a.tags;e.cacheInitialPreview={},e.hasInitData&&(e._initPreview(),e._initPreviewActions())}e.unlock(i),i&&e._clearFileInput(),c=e.$preview.find(".file-preview-initial"),e.uploadAsync&&c.length&&(b.addCss(c,b.SORT_CSS),e._initSortable()),e._raise("filebatchuploadcomplete",[e.filestack,e._getExtraData()]),e.uploadCount=0,e.uploadStatus={},e.uploadLog=[],e._setProgress(101)},100))},q=function(f){h=e._getOutData(f),e.fileBatchCompleted=!1,e.showPreview&&(j.hasClass("file-preview-success")||(e._setThumbStatus(j,"Loading"),b.addCss(j,"file-uploading")),l.attr("disabled",!0),m.attr("disabled",!0)),d||e.lock(),e._raise("filepreupload",[h,i,c]),a.extend(!0,v,h),e._abort(v)&&(f.abort(),e._setProgressCancelled())},r=function(f,g,k){var m=e.showPreview&&j.attr("id")?j.attr("id"):i;h=e._getOutData(k,f),a.extend(!0,v,h),setTimeout(function(){b.isEmpty(f)||b.isEmpty(f.error)?(e.showPreview&&(e._setThumbStatus(j,"Success"),l.hide(),e._initUploadSuccess(f,j,d),e._setProgress(101,p)),e._raise("fileuploaded",[h,m,c]),d?u(c,m):e.updateStack(c,void 0)):(o=!0,e._showUploadError(f.error,v),e._setPreviewError(j,c,e.filestack[c],e.retryErrorUploads),e.retryErrorUploads||l.hide(),d&&u(c,m),e._setProgress(101,a("#"+m).find(".file-thumb-progress"),e.msgUploadError))},100)},s=function(){setTimeout(function(){e.showPreview&&(l.removeAttr("disabled"),m.removeAttr("disabled"),j.removeClass("file-uploading")),d?k():(e.unlock(!1),e._clearFileInput()),e._initSuccessThumbs()},100)},t=function(b,f,g){var h=e.ajaxOperations.uploadThumb,k=e._parseError(h,b,g,d&&e.filestack[c].name?e.filestack[c].name:null);o=!0,setTimeout(function(){d&&u(c,i),e.uploadStatus[i]=100,e._setPreviewError(j,c,e.filestack[c],e.retryErrorUploads),e.retryErrorUploads||l.hide(),a.extend(!0,v,e._getOutData(b)),e._setProgress(101,p,e.msgAjaxProgressError.replace("{operation}",h)),e._setProgress(101,a("#"+i).find(".file-thumb-progress"),e.msgUploadError),e._showUploadError(k,v)},100)},g.append(e.uploadFileAttr,e.filestack[c],e.filenames[c]),g.append("file_id",c),e._ajaxSubmit(q,r,s,t,i,c))},_uploadBatch:function(){var g,h,i,j,l,c=this,d=c.filestack,e=d.length,f={},k=c.filestack.length>0||!a.isEmptyObject(c.uploadExtraData);c.formdata=new FormData,0!==e&&k&&!c._abort(f)&&(l=function(){a.each(d,function(a){c.updateStack(a,void 0)}),c._clearFileInput()},g=function(d){c.lock();var e=c._getOutData(d);c.showPreview&&c._getThumbs().each(function(){var d=a(this),e=d.find(".kv-file-upload"),f=d.find(".kv-file-remove");d.hasClass("file-preview-success")||(c._setThumbStatus(d,"Loading"),b.addCss(d,"file-uploading")),e.attr("disabled",!0),f.attr("disabled",!0)}),c._raise("filebatchpreupload",[e]),c._abort(e)&&(d.abort(),c._setProgressCancelled())},h=function(d,e,f){var g=c._getOutData(f,d),h=0,i=c._getThumbs(":not(.file-preview-success)"),j=b.isEmpty(d)||b.isEmpty(d.errorkeys)?[]:d.errorkeys;b.isEmpty(d)||b.isEmpty(d.error)?(c._raise("filebatchuploadsuccess",[g]),l(),c.showPreview?(i.each(function(){var b=a(this);c._setThumbStatus(b,"Success"),b.removeClass("file-uploading"),b.find(".kv-file-upload").hide().removeAttr("disabled")}),c._initUploadSuccess(d)):c.reset(),c._setProgress(101)):(c.showPreview&&(i.each(function(){var b=a(this),d=b.attr("data-fileindex");b.removeClass("file-uploading"),b.find(".kv-file-upload").removeAttr("disabled"),b.find(".kv-file-remove").removeAttr("disabled"),0===j.length||-1!==a.inArray(h,j)?(c._setPreviewError(b,d,c.filestack[d],c.retryErrorUploads),c.retryErrorUploads||(b.find(".kv-file-upload").hide(),c.updateStack(d,void 0))):(b.find(".kv-file-upload").hide(),c._setThumbStatus(b,"Success"),c.updateStack(d,void 0)),(!b.hasClass("file-preview-error")||c.retryErrorUploads)&&h++}),c._initUploadSuccess(d)),c._showUploadError(d.error,g,"filebatchuploaderror"),c._setProgress(101,c.$progress,c.msgUploadError))},j=function(){c.unlock(),c._initSuccessThumbs(),c._clearFileInput(),c._raise("filebatchuploadcomplete",[c.filestack,c._getExtraData()])},i=function(b,d,f){var g=c._getOutData(b),h=c.ajaxOperations.uploadBatch,i=c._parseError(h,b,f);c._showUploadError(i,g,"filebatchuploaderror"),c.uploadFileCount=e-1,c.showPreview&&(c._getThumbs().each(function(){var b=a(this),d=b.attr("data-fileindex");b.removeClass("file-uploading"),void 0!==c.filestack[d]&&c._setPreviewError(b)}),c._getThumbs().removeClass("file-uploading"),c._getThumbs(" .kv-file-upload").removeAttr("disabled"),c._getThumbs(" .kv-file-delete").removeAttr("disabled"),c._setProgress(101,c.$progress,c.msgAjaxProgressError.replace("{operation}",h)))},a.each(d,function(a,e){b.isEmpty(d[a])||c.formdata.append(c.uploadFileAttr,e,c.filenames[a])}),c._ajaxSubmit(g,h,j,i))},_uploadExtraOnly:function(){var d,e,f,g,a=this,c={};a.formdata=new FormData,a._abort(c)||(d=function(b){a.lock();var d=a._getOutData(b);a._raise("filebatchpreupload",[d]),a._setProgress(50),c.data=d,c.xhr=b,a._abort(c)&&(b.abort(),a._setProgressCancelled())},e=function(c,d,e){var f=a._getOutData(e,c);b.isEmpty(c)||b.isEmpty(c.error)?(a._raise("filebatchuploadsuccess",[f]),a._clearFileInput(),a._initUploadSuccess(c),a._setProgress(101)):a._showUploadError(c.error,f,"filebatchuploaderror")},f=function(){a.unlock(),a._clearFileInput(),a._raise("filebatchuploadcomplete",[a.filestack,a._getExtraData()])},g=function(b,d,e){var f=a._getOutData(b),g=a.ajaxOperations.uploadExtra,h=a._parseError(g,b,e);c.data=f,a._showUploadError(h,f,"filebatchuploaderror"),a._setProgress(101,a.$progress,a.msgAjaxProgressError.replace("{operation}",g))},a._ajaxSubmit(d,e,f,g))},_deleteFileIndex:function(c){var d=this,e=c.attr("data-fileindex");"init_"===e.substring(0,5)&&(e=parseInt(e.replace("init_","")),d.initialPreview=b.spliceArray(d.initialPreview,e),d.initialPreviewConfig=b.spliceArray(d.initialPreviewConfig,e),d.initialPreviewThumbTags=b.spliceArray(d.initialPreviewThumbTags,e),d.getFrames().each(function(){var b=a(this),c=b.attr("data-fileindex");"init_"===c.substring(0,5)&&(c=parseInt(c.replace("init_","")),c>e&&(c--,b.attr("data-fileindex","init_"+c)))}),d.uploadAsync&&(d.cacheInitialPreview=d.getPreview()))},_initFileActions:function(){var c=this,d=c.$preview;c.showPreview&&(c._initZoomButton(),c.getFrames(" .kv-file-remove").each(function(){var g,j,k,l,e=a(this),f=e.closest(b.FRAMES),h=f.attr("id"),i=f.attr("data-fileindex");c._handler(e,"click",function(){return l=c._raise("filepreremove",[h,i]),l!==!1&&c._validateMinCount()?(g=f.hasClass("file-preview-error"),b.cleanMemory(f),f.fadeOut("slow",function(){b.cleanZoomCache(d.find("#zoom-"+h)),c.updateStack(i,void 0),c._clearObjects(f),f.remove(),h&&g&&c.$errorContainer.find('li[data-file-id="'+h+'"]').fadeOut("fast",function(){a(this).remove(),c._errorsExist()||c._resetErrors()}),c._clearFileInput();var e=c.getFileStack(!0),l=c.previewCache.count(),m=e.length,n=c.showPreview&&c.getFrames().length;0!==m||0!==l||n?(j=l+m,k=j>1?c._getMsgSelected(j):e[0]?c._getFileNames()[0]:"",c._setCaption(k)):c.reset(),c._raise("fileremoved",[h,i])}),void 0):!1})}),c.getFrames(" .kv-file-upload").each(function(){var d=a(this);c._handler(d,"click",function(){var a=d.closest(b.FRAMES),e=a.attr("data-fileindex");c.$progress.hide(),(!a.hasClass("file-preview-error")||c.retryErrorUploads)&&c._uploadSingle(e,!1)})}))},_initPreviewActions:function(){var c=this,d=c.$preview,e=c.deleteExtraData||{},f=b.FRAMES+" .kv-file-remove",g=c.fileActionSettings,h=g.removeClass,i=g.removeErrorClass,j=function(){var a=c.isAjaxUpload?c.previewCache.count():c.$element.get(0).files.length;d.find(b.FRAMES).length||a||(c._setCaption(""),c.reset(),c.initialCaption="")};c._initZoomButton(),d.find(f).each(function(){var l,m,n,q,r,t,u,o,p,s,f=a(this),g=f.data("url")||c.deleteUrl,k=f.data("key");b.isEmpty(g)||void 0===k||(o=f.closest(b.FRAMES),p=c.previewCache.data,s=o.attr("data-fileindex"),s=parseInt(s.replace("init_","")),t=b.isEmpty(p.config)&&b.isEmpty(p.config[s])?null:p.config[s],u=b.isEmpty(t)||b.isEmpty(t.extra)?e:t.extra,"function"==typeof u&&(u=u()),r={id:f.attr("id"),key:k,extra:u},l=function(a){c.ajaxAborted=!1,c._raise("filepredelete",[k,a,u]),f.removeClass(i),c._abort()?a.abort():(b.addCss(o,"file-uploading"),b.addCss(f,"disabled "+h))},m=function(a,e,g){var l,m;return b.isEmpty(a)||b.isEmpty(a.error)?(o.removeClass("file-uploading").addClass("file-deleted"),o.fadeOut("slow",function(){s=parseInt(o.attr("data-fileindex").replace("init_","")),c.previewCache.unset(s),l=c.previewCache.count(),m=l>0?c._getMsgSelected(l):"",c._deleteFileIndex(o),c._setCaption(m),c._raise("filedeleted",[k,g,u]),b.cleanZoomCache(d.find("#zoom-"+o.attr("id"))),c._clearObjects(o),o.remove(),j()}),void 0):(r.jqXHR=g,r.response=a,c._showError(a.error,r,"filedeleteerror"),o.removeClass("file-uploading"),f.removeClass("disabled "+h).addClass(i),j(),void 0)},n=function(a,b,d){var e=c.ajaxOperations.deleteThumb,g=c._parseError(e,a,d);r.jqXHR=a,r.response={},c._showError(g,r,"filedeleteerror"),o.removeClass("file-uploading"),f.removeClass("disabled "+h).addClass(i),j()},c._mergeAjaxCallback("beforeSend",l,"delete"),c._mergeAjaxCallback("success",m,"delete"),c._mergeAjaxCallback("error",n,"delete"),q=a.extend(!0,{},{url:g,type:"POST",dataType:"json",data:a.extend(!0,{},{key:k},u)},c.ajaxDeleteSettings),c._handler(f,"click",function(){return c._validateMinCount()?(c.ajaxAborted=!1,c._raise("filebeforedelete",[k,u]),c.ajaxAborted instanceof Promise?c.ajaxAborted.then(function(b){b||a.ajax(q)}):c.ajaxAborted||a.ajax(q),void 0):!1}))})},_hideFileIcon:function(){var a=this;a.overwriteInitial&&a.$captionContainer.removeClass("icon-visible")},_showFileIcon:function(){var a=this;b.addCss(a.$captionContainer,"icon-visible")},_getSize:function(b){var e,g,h,c=this,d=parseFloat(b),f=c.fileSizeGetter;return a.isNumeric(b)&&a.isNumeric(d)?("function"==typeof f?h=f(d):0===d?h="0.00 B":(e=Math.floor(Math.log(d)/Math.log(1024)),g=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],h=1*(d/Math.pow(1024,e)).toFixed(2)+" "+g[e]),c._getLayoutTemplate("size").replace("{sizeText}",h)):""},_generatePreviewTemplate:function(c,d,e,f,g,h,i,j,k,l,m){var p,z,n=this,o=n.slug(e),q="",r="",s=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,t=400>s?n.previewSettingsSmall[c]||n.defaults.previewSettingsSmall[c]:n.previewSettings[c]||n.defaults.previewSettings[c],u=k||n._renderFileFooter(o,i,"auto",h),v=n._getPreviewIcon(e),w="type-default",x=v&&n.preferIconicPreview,y=v&&n.preferIconicZoomPreview;return t&&a.each(t,function(a,b){r+=a+":"+b+";"}),z=function(d,h,i,k){var p=i?"zoom-"+g:g,q=n._getPreviewTemplate(d),s=(j||"")+" "+k;return n.frameClass&&(s=n.frameClass+" "+s),i&&(s=s.replace(" "+b.SORT_CSS,"")),q=n._parseFilePreviewIcon(q,e),"text"===d&&(h=b.htmlEncode(h)),"object"!==c||f||a.each(n.defaults.fileTypeSettings,function(a,b){"object"!==a&&"other"!==a&&b(e,f)&&(w="type-"+a)}),q.setTokens({previewId:p,caption:o,frameClass:s,type:f,fileindex:l,typeCss:w,footer:u,data:h,template:m||c,style:r?'style="'+r+'"':""})},l=l||g.slice(g.lastIndexOf("-")+1),n.fileActionSettings.showZoom&&(q=z(y?"other":c,d,!0,"kv-zoom-thumb")),q="\n"+n._getLayoutTemplate("zoomCache").replace("{zoomContent}",q),p=z(x?"other":c,d,!1,"kv-preview-thumb"),p+q},_previewDefault:function(c,d,e){var j,h,i,k,l,m,n,f=this,g=f.$preview;f.showPreview&&(h=c?c.name:"",i=c?c.type:"",k=c.size||0,l=f.slug(h),m=e===!0&&!f.isAjaxUpload,n=b.objUrl.createObjectURL(c),f._clearDefaultPreview(),j=f._generatePreviewTemplate("other",n,h,i,d,m,k),g.append("\n"+j),f._setThumbAttr(d,l,k),e===!0&&f.isAjaxUpload&&f._setThumbStatus(a("#"+d),"Error"))},_previewFile:function(a,c,d,e,f,g){var n,h,i,j,k,l,m,o,p,q,r,s,t,u;this.showPreview&&(h=this,i=c?c.name:"",j=g.type,k=g.name,l=h._parseFileType(j,i),m=h.allowedPreviewTypes,o=h.allowedPreviewMimeTypes,p=h.$preview,q=c.size||0,r=m&&m.indexOf(l)>=0,s=o&&-1!==o.indexOf(j),t="text"===l||"html"===l||"image"===l?d.target.result:f,"html"===l&&h.purifyHtml&&window.DOMPurify&&(t=window.DOMPurify.sanitize(t)),r||s?(n=h._generatePreviewTemplate(l,t,i,j,e,!1,q),h._clearDefaultPreview(),p.append("\n"+n),u=p.find("#"+e+" img"),u.length&&h.autoOrientImage?b.validateOrientation(c,function(a){if(!a)return h._validateImage(e,k,j,q,t),void 0;var d=p.find("#zoom-"+e+" img"),f="rotate-"+a;a>4&&(f+=u.width()>u.height()?" is-portrait-gt4":" is-landscape-gt4"),b.addCss(u,f),b.addCss(d,f),h._raise("fileimageoriented",{$img:u,file:c}),h._validateImage(e,k,j,q,t),b.adjustOrientedImage(u)}):h._validateImage(e,k,j,q,t)):h._previewDefault(c,e),h._setThumbAttr(e,k,q),h._initSortable())},_setThumbAttr:function(b,c,d){var e=this,f=a("#"+b);f.length&&(d=d&&d>0?e._getSize(d):"",f.data({caption:c,size:d}))},_setInitThumbAttr:function(){var e,f,g,h,i,a=this,c=a.previewCache.data,d=a.previewCache.count();if(0!==d)for(i=0;d>i;i++)e=c.config[i],h=a.previewInitId+"-"+"init_"+i,f=b.ifSet("caption",e,b.ifSet("filename",e)),g=b.ifSet("size",e),a._setThumbAttr(h,f,g)},_slugDefault:function(a){return b.isEmpty(a)?"":String(a).replace(/[\-\[\]\/\{}:;#%=\(\)\*\+\?\\\^\$\|<>&"']/g,"_")},_readFiles:function(c){this.reader=new FileReader;var p,d=this,e=d.$element,f=d.$preview,g=d.reader,h=d.$previewContainer,i=d.$previewStatus,j=d.msgLoading,k=d.msgProgress,l=d.previewInitId,m=c.length,n=d.fileTypeSettings,o=d.filestack.length,q=d.allowedFileTypes,r=q?q.length:0,s=d.allowedFileExtensions,t=b.isEmpty(s)?"":s.join(", "),u=d.maxFilePreviewSize&&parseFloat(d.maxFilePreviewSize),v=f.length&&(!u||isNaN(u)),w=function(b,e,f,g){var j,h=a.extend(!0,{},d._getOutData({},{},c),{id:f,index:g}),i={id:f,index:g,file:e,files:c};d._previewDefault(e,f,!0),d.isAjaxUpload?(d.addToStack(void 0),setTimeout(function(){p(g+1)},100)):m=0,d._initFileActions(),j=a("#"+f),j.find(".kv-file-upload").hide(),d.removeFromPreviewOnError&&j.remove(),d.isError=d.isAjaxUpload?d._showUploadError(b,h):d._showError(b,i),d._updateFileDetails(m)};d.loadedImages=[],d.totalImagesCount=0,a.each(c,function(a,b){var c=d.fileTypeSettings.image;c&&c(b.type)&&d.totalImagesCount++}),p=function(x){if(b.isEmpty(e.attr("multiple"))&&(m=1),x>=m)return d.isAjaxUpload&&d.filestack.length>0?d._raise("filebatchselected",[d.getFileStack()]):d._raise("filebatchselected",[c]),h.removeClass("file-thumb-loading"),i.html(""),void 0;var B,C,D,H,I,J,K,R,T,U,V,W,y=o+x,z=l+"-"+y,A=c[x],E=n.text,F=n.image,G=n.html,L=A.name?d.slug(A.name):"",M=(A.size||0)/1e3,N="",O=b.objUrl.createObjectURL(A),P=0,Q="",S=0,X=function(){var a=k.setTokens({index:x+1,files:m,percent:50,name:L});setTimeout(function(){i.html(a),d._updateFileDetails(m),p(x+1)},100),d._raise("fileloaded",[A,z,x,g])};if(r>0)for(C=0;r>C;C++)J=q[C],K=d.msgFileTypes[J]||J,Q+=0===C?K:", "+K;if(L===!1)return p(x+1),void 0;if(0===L.length)return D=d.msgInvalidFileName.replace("{name}",b.htmlEncode(A.name)),w(D,A,z,x),void 0;if(b.isEmpty(s)||(N=new RegExp("\\.("+s.join("|")+")$","i")),B=M.toFixed(2),d.maxFileSize>0&&M>d.maxFileSize)return D=d.msgSizeTooLarge.setTokens({name:L,size:B,maxSize:d.maxFileSize}),w(D,A,z,x),void 0;if(null!==d.minFileSize&&M<=b.getNum(d.minFileSize))return D=d.msgSizeTooSmall.setTokens({name:L,size:B,minSize:d.minFileSize}),w(D,A,z,x),void 0;if(!b.isEmpty(q)&&b.isArray(q)){for(C=0;C<q.length;C+=1)H=q[C],R=n[H],P+=R&&"function"==typeof R?R(A.type,A.name)?1:0:0;if(0===P)return D=d.msgInvalidFileType.setTokens({name:L,types:Q}),w(D,A,z,x),void 0}return 0!==P||b.isEmpty(s)||!b.isArray(s)||b.isEmpty(N)||(I=b.compare(L,N),P+=b.isEmpty(I)?0:I.length,0!==P)?d.showPreview?!v&&M>u?(d.addToStack(A),h.addClass("file-thumb-loading"),d._previewDefault(A,z),d._initFileActions(),d._updateFileDetails(m),p(x+1),void 0):(f.length&&void 0!==FileReader?(T=E(A.type,L),U=G(A.type,L),V=F(A.type,L),i.html(j.replace("{index}",x+1).replace("{files}",m)),h.addClass("file-thumb-loading"),g.onerror=function(a){d._errorHandler(a,L)},g.onload=function(c){var e,f,h,j,k,i=[],l=function(a){var b=new FileReader;b.onerror=function(a){d._errorHandler(a,L)},b.onload=function(a){d._previewFile(x,A,a,z,O,h),d._initFileActions(),X()},a?b.readAsText(A,d.textEncoding):b.readAsDataURL(A)};return h={name:L,type:A.type},a.each(n,function(a,b){"object"!==a&&"other"!==a&&b(A.type,L)&&S++}),0===S&&(e=new Uint8Array(c.target.result),e.forEach(function(a){i.push(a.toString(16))}),f=i.join("").toLowerCase().substring(0,8),k=b.getMimeType(f,"",""),b.isEmpty(k)&&(j=b.arrayBuffer2String(g.result),k=b.isSvg(j)?"image/svg+xml":b.getMimeType(f,j,A.type)),h={name:L,type:k},T=E(k,""),U=G(k,""),V=F(k,""),W=T||U,W||V)?(l(W),void 0):(d._previewFile(x,A,c,z,O,h),d._initFileActions(),X(),void 0)},g.onprogress=function(a){if(a.lengthComputable){var b=100*(a.loaded/a.total),c=Math.ceil(b);D=k.setTokens({index:x+1,files:m,percent:c,name:L}),setTimeout(function(){i.html(D)},100)}},T||U?g.readAsText(A,d.textEncoding):V?g.readAsDataURL(A):g.readAsArrayBuffer(A)):(d._previewDefault(A,z),setTimeout(function(){p(x+1),d._updateFileDetails(m)},100),d._raise("fileloaded",[A,z,x,g])),d.addToStack(A),void 0):(d.isAjaxUpload&&d.addToStack(A),setTimeout(function(){p(x+1),d._updateFileDetails(m)},100),d._raise("fileloaded",[A,z,x,g]),void 0):(D=d.msgInvalidFileExtension.setTokens({name:L,extensions:t}),w(D,A,z,x),void 0)},p(0),d._updateFileDetails(m,!1)},_updateFileDetails:function(a){var c=this,d=c.$element,e=c.getFileStack(),f=b.isIE(9)&&b.findFileName(d.val())||d[0].files[0]&&d[0].files[0].name||e.length&&e[0].name||"",g=c.slug(f),h=c.isAjaxUpload?e.length:a,i=c.previewCache.count()+h,j=1===h?g:c._getMsgSelected(i);
    c.isError?(c.$previewContainer.removeClass("file-thumb-loading"),c.$previewStatus.html(""),c.$captionContainer.removeClass("icon-visible")):c._showFileIcon(),c._setCaption(j,c.isError),c.$container.removeClass("file-input-new file-input-ajax-new"),1===arguments.length&&c._raise("fileselect",[a,g]),c.previewCache.count()&&c._initPreviewActions()},_setThumbStatus:function(a,b){var d,e,f,g,h,c=this;c.showPreview&&(d="indicator"+b,e=d+"Title",f="file-preview-"+b.toLowerCase(),g=a.find(".file-upload-indicator"),h=c.fileActionSettings,a.removeClass("file-preview-success file-preview-error file-preview-loading"),"Success"===b&&a.find(".file-drag-handle").remove(),g.html(h[d]),g.attr("title",h[e]),a.addClass(f),"Error"!==b||c.retryErrorUploads||a.find(".kv-file-upload").attr("disabled",!0))},_setProgressCancelled:function(){var a=this;a._setProgress(101,a.$progress,a.msgCancelled)},_setProgress:function(a,c,d){var g,e=this,f=Math.min(a,100),h=e.progressUploadThreshold,i=100>=a?e.progressTemplate:e.progressCompleteTemplate,j=100>f?e.progressTemplate:d?e.progressErrorTemplate:i;c=c||e.$progress,b.isEmpty(j)||(g=h&&f>h&&100>=a?j.setTokens({percent:h,status:e.msgUploadThreshold}):j.setTokens({percent:f,status:a>100?e.msgUploadEnd:f+"%"}),c.html(g),d&&c.find('[role="progressbar"]').html(d))},_setFileDropZoneTitle:function(){var e,a=this,c=a.$container.find(".file-drop-zone"),d=a.dropZoneTitle;a.isClickable&&(e=b.isEmpty(a.$element.attr("multiple"))?a.fileSingle:a.filePlural,d+=a.dropZoneClickTitle.replace("{files}",e)),c.find("."+a.dropZoneTitleClass).remove(),a.isAjaxUpload&&a.showPreview&&0!==c.length&&!(a.getFileStack().length>0)&&a.dropZoneEnabled&&(0===c.find(b.FRAMES).length&&b.isEmpty(a.defaultPreviewContent)&&c.prepend('<div class="'+a.dropZoneTitleClass+'">'+d+"</div>"),a.$container.removeClass("file-input-new"),b.addCss(a.$container,"file-input-ajax-new"))},_setAsyncUploadStatus:function(b,c,d){var e=this,f=0;e._setProgress(c,a("#"+b).find(".file-thumb-progress")),e.uploadStatus[b]=c,a.each(e.uploadStatus,function(a,b){f+=b}),e._setProgress(Math.floor(f/d))},_validateMinCount:function(){var a=this,b=a.isAjaxUpload?a.getFileStack().length:a.$element.get(0).files.length;return a.validateInitialCount&&a.minFileCount>0&&a._getFileCount(b-1)<a.minFileCount?(a._noFilesError({}),!1):!0},_getFileCount:function(a){var b=this,c=0;return b.validateInitialCount&&!b.overwriteInitial&&(c=b.previewCache.count(),a+=c),a},_getFileId:function(a){var d,b=this,c=b.generateFileId;return"function"==typeof c?c(a,event):a?(d=String(a.webkitRelativePath||a.fileName||a.name||null),d?a.size+"-"+d.replace(/[^0-9a-zA-Z_-]/gim,""):null):null},_getFileName:function(a){return a&&a.name?this.slug(a.name):void 0},_getFileIds:function(a){var b=this;return b.fileids.filter(function(b){return a?void 0!==b:void 0!==b&&null!==b})},_getFileNames:function(a){var b=this;return b.filenames.filter(function(b){return a?void 0!==b:void 0!==b&&null!==b})},_setPreviewError:function(a,b,c,d){var e=this;if(void 0!==b&&e.updateStack(b,c),e.showPreview){if(e.removeFromPreviewOnError&&!d)return a.remove(),void 0;e._setThumbStatus(a,"Error"),e._refreshUploadButton(a,d)}},_refreshUploadButton:function(a,b){var c=this,d=a.find(".kv-file-upload"),e=c.fileActionSettings,f=e.uploadIcon,g=e.uploadTitle;d.length&&(b&&(f=e.uploadRetryIcon,g=e.uploadRetryTitle),d.attr("title",g).html(f))},_checkDimensions:function(a,c,d,e,f,g,h){var j,k,n,o,i=this,l="Small"===c?"min":"max",m=i[l+"Image"+g];!b.isEmpty(m)&&d.length&&(n=d[0],k="Width"===g?n.naturalWidth||n.width:n.naturalHeight||n.height,o="Small"===c?k>=m:m>=k,o||(j=i["msgImage"+g+c].setTokens({name:f,size:m}),i._showUploadError(j,h),i._setPreviewError(e,a,null)))},_validateImage:function(b,c,d,e,f){var i,j,k,o,g=this,h=g.$preview,l=h.find("#"+b),m=l.attr("data-fileindex"),n=l.find("img");c=c||"Untitled",n.one("load",function(){j=l.width(),k=h.width(),j>k&&n.css("width","100%"),i={ind:m,id:b},g._checkDimensions(m,"Small",n,l,c,"Width",i),g._checkDimensions(m,"Small",n,l,c,"Height",i),g.resizeImage||(g._checkDimensions(m,"Large",n,l,c,"Width",i),g._checkDimensions(m,"Large",n,l,c,"Height",i)),g._raise("fileimageloaded",[b]),o=window.piexif?window.piexif.load(f):null,g.loadedImages.push({ind:m,img:n,thumb:l,pid:b,typ:d,siz:e,validated:!1,imgData:f,exifObj:o}),l.data("exif",o),g._validateAllImages()}).one("error",function(){g._raise("fileimageloaderror",[b])}).each(function(){this.complete?a(this).trigger("load"):this.error&&a(this).trigger("error")})},_validateAllImages:function(){var b,e,f,a=this,c={val:0},d=a.loadedImages.length,g=a.resizeIfSizeMoreThan;if(d===a.totalImagesCount&&(a._raise("fileimagesloaded"),a.resizeImage))for(b=0;b<a.loadedImages.length;b++)e=a.loadedImages[b],e.validated||(f=e.siz,f&&f>1e3*g&&a._getResizedImage(e,c,d),a.loadedImages[b].validated=!0)},_getResizedImage:function(c,d,e){var j,o,p,r,x,y,A,f=this,g=a(c.img)[0],h=g.naturalWidth,i=g.naturalHeight,k=1,l=f.maxImageWidth||h,m=f.maxImageHeight||i,n=!(!h||!i),q=f.imageCanvas,s=f.imageCanvasContext,t=c.typ,u=c.pid,v=c.ind,w=c.thumb,z=c.exifObj;if(x=function(a,b,c){f.isAjaxUpload?f._showUploadError(a,b,c):f._showError(a,b,c),f._setPreviewError(w,v)},(!f.filestack[v]||!n||l>=h&&m>=i)&&(n&&f.filestack[v]&&f._raise("fileimageresized",[u,v]),d.val++,d.val===e&&f._raise("fileimagesresized"),!n))return x(f.msgImageResizeError,{id:u,index:v},"fileimageresizeerror"),void 0;t=t||f.resizeDefaultImageType,o=h>l,p=i>m,k="width"===f.resizePreference?o?l/h:p?m/i:1:p?m/i:o?l/h:1,f._resetCanvas(),h*=k,i*=k,q.width=h,q.height=i;try{s.drawImage(g,0,0,h,i),r=q.toDataURL(t,f.resizeQuality),z&&(A=window.piexif.dump(z),r=window.piexif.insert(A,r)),j=b.dataURI2Blob(r),f.filestack[v]=j,f._raise("fileimageresized",[u,v]),d.val++,d.val===e&&f._raise("fileimagesresized",[void 0,void 0]),j instanceof Blob||x(f.msgImageResizeError,{id:u,index:v},"fileimageresizeerror")}catch(B){d.val++,d.val===e&&f._raise("fileimagesresized",[void 0,void 0]),y=f.msgImageResizeException.replace("{errors}",B.message),x(y,{id:u,index:v},"fileimageresizeexception")}},_initBrowse:function(a){var b=this;b.showBrowse?(b.$btnFile=a.find(".btn-file"),b.$btnFile.append(b.$element)):b.$element.hide()},_initCaption:function(){var a=this,c=a.initialCaption||"";return a.overwriteInitial||b.isEmpty(c)?(a.$caption.val(""),!1):(a._setCaption(c),!0)},_setCaption:function(c,d){var f,g,h,i,j,e=this,k=e.getFileStack();if(e.$caption.length){if(e.$captionContainer.removeClass("icon-visible"),d)f=a("<div>"+e.msgValidationError+"</div>").text(),i=k.length,j=i?1===i&&k[0]?e._getFileNames()[0]:e._getMsgSelected(i):e._getMsgSelected(e.msgNo),g=b.isEmpty(c)?j:c,h='<span class="'+e.msgValidationErrorClass+'">'+e.msgValidationErrorIcon+"</span>";else{if(b.isEmpty(c))return;f=a("<div>"+c+"</div>").text(),g=f,h=e._getLayoutTemplate("fileIcon")}e.$captionContainer.addClass("icon-visible"),e.$caption.attr("title",f).val(g),e.$captionIcon.html(h)}},_createContainer:function(){var b=this,c={"class":"file-input file-input-new"+(b.rtl?" kv-rtl":"")},d=a(document.createElement("div")).attr(c).html(b._renderMain());return b.$element.before(d),b._initBrowse(d),b.theme&&d.addClass("theme-"+b.theme),d},_refreshContainer:function(){var a=this,b=a.$container;b.before(a.$element),b.html(a._renderMain()),a._initBrowse(b),a._validateDisabled()},_validateDisabled:function(){var a=this;a.$caption.attr({readonly:a.isDisabled})},_renderMain:function(){var a=this,b=a.isAjaxUpload&&a.dropZoneEnabled?" file-drop-zone":"file-drop-disabled",c=a.showClose?a._getLayoutTemplate("close"):"",d=a.showPreview?a._getLayoutTemplate("preview").setTokens({"class":a.previewClass,dropClass:b}):"",e=a.isDisabled?a.captionClass+" file-caption-disabled":a.captionClass,f=a.captionTemplate.setTokens({"class":e+" kv-fileinput-caption"});return a.mainTemplate.setTokens({"class":a.mainClass+(!a.showBrowse&&a.showCaption?" no-browse":""),preview:d,close:c,caption:f,upload:a._renderButton("upload"),remove:a._renderButton("remove"),cancel:a._renderButton("cancel"),browse:a._renderButton("browse")})},_renderButton:function(a){var c=this,d=c._getLayoutTemplate("btnDefault"),e=c[a+"Class"],f=c[a+"Title"],g=c[a+"Icon"],h=c[a+"Label"],i=c.isDisabled?" disabled":"",j="button";switch(a){case"remove":if(!c.showRemove)return"";break;case"cancel":if(!c.showCancel)return"";e+=" kv-hidden";break;case"upload":if(!c.showUpload)return"";c.isAjaxUpload&&!c.isDisabled?d=c._getLayoutTemplate("btnLink").replace("{href}",c.uploadUrl):j="submit";break;case"browse":if(!c.showBrowse)return"";d=c._getLayoutTemplate("btnBrowse");break;default:return""}return e+="browse"===a?" btn-file":" fileinput-"+a+" fileinput-"+a+"-button",b.isEmpty(h)||(h=' <span class="'+c.buttonLabelClass+'">'+h+"</span>"),d.setTokens({type:j,css:e,title:f,status:i,icon:g,label:h})},_renderThumbProgress:function(){var a=this;return'<div class="file-thumb-progress kv-hidden">'+a.progressTemplate.setTokens({percent:"0",status:a.msgUploadBegin})+"</div>"},_renderFileFooter:function(a,c,d,e){var l,f=this,g=f.fileActionSettings,h=g.showRemove,i=g.showDrag,j=g.showUpload,k=g.showZoom,m=f._getLayoutTemplate("footer"),n=f._getLayoutTemplate("indicator"),o=e?g.indicatorError:g.indicatorNew,p=e?g.indicatorErrorTitle:g.indicatorNewTitle,q=n.setTokens({indicator:o,indicatorTitle:p});return c=f._getSize(c),l=f.isAjaxUpload?m.setTokens({actions:f._renderFileActions(j,!1,h,k,i,!1,!1,!1),caption:a,size:c,width:d,progress:f._renderThumbProgress(),indicator:q}):m.setTokens({actions:f._renderFileActions(!1,!1,!1,k,i,!1,!1,!1),caption:a,size:c,width:d,progress:"",indicator:q}),l=b.replaceTags(l,f.previewThumbTags)},_renderFileActions:function(a,b,c,d,e,f,g,h,i,j,k){if(!(a||b||c||d||e))return"";var t,l=this,m=g===!1?"":' data-url="'+g+'"',n=h===!1?"":' data-key="'+h+'"',o="",p="",q="",r="",s="",u=l._getLayoutTemplate("actions"),v=l.fileActionSettings,w=l.otherActionButtons.setTokens({dataKey:n,key:h}),x=f?v.removeClass+" disabled":v.removeClass;return c&&(o=l._getLayoutTemplate("actionDelete").setTokens({removeClass:x,removeIcon:v.removeIcon,removeTitle:v.removeTitle,dataUrl:m,dataKey:n,key:h})),a&&(p=l._getLayoutTemplate("actionUpload").setTokens({uploadClass:v.uploadClass,uploadIcon:v.uploadIcon,uploadTitle:v.uploadTitle})),b&&(q=l._getLayoutTemplate("actionDownload").setTokens({downloadClass:v.downloadClass,downloadIcon:v.downloadIcon,downloadTitle:v.downloadTitle,downloadUrl:j||l.initialPreviewDownloadUrl}),q=q.setTokens({filename:k,key:h})),d&&(r=l._getLayoutTemplate("actionZoom").setTokens({zoomClass:v.zoomClass,zoomIcon:v.zoomIcon,zoomTitle:v.zoomTitle})),e&&i&&(t="drag-handle-init "+v.dragClass,s=l._getLayoutTemplate("actionDrag").setTokens({dragClass:t,dragTitle:v.dragTitle,dragIcon:v.dragIcon})),u.setTokens({"delete":o,upload:p,download:q,zoom:r,drag:s,other:w})},_browse:function(a){var b=this;b._raise("filebrowse"),a&&a.isDefaultPrevented()||(b.isError&&!b.isAjaxUpload&&b.clear(),b.$captionContainer.focus())},_filterDuplicate:function(a,b,c){var d=this,e=d._getFileId(a);e&&c&&c.indexOf(e)>-1||(c||(c=[]),b.push(a),c.push(e))},_change:function(c){var g,h,k,l,f,i,j,m,n,o,p,q,r,s,d=this,e=d.$element;if(!d.isAjaxUpload&&b.isEmpty(e.val())&&d.fileInputCleared)return d.fileInputCleared=!1,void 0;if(d.fileInputCleared=!1,f=[],i=arguments.length>1,j=d.isAjaxUpload,m=i?c.originalEvent.dataTransfer.files:e.get(0).files,n=d.filestack.length,o=b.isEmpty(e.attr("multiple")),p=o&&n>0,q=0,r=d._getFileIds(),s=function(b,c,e,f){var g=a.extend(!0,{},d._getOutData({},{},m),{id:e,index:f}),h={id:e,index:f,file:c,files:m};return d.isAjaxUpload?d._showUploadError(b,g):d._showError(b,h)},d.reader=null,d._resetUpload(),d._hideFileIcon(),d.isAjaxUpload&&d.$container.find(".file-drop-zone ."+d.dropZoneTitleClass).remove(),i?a.each(m,function(a,b){b&&!b.type&&void 0!==b.size&&0===b.size%4096?q++:d._filterDuplicate(b,f,r)}):(m=c.target&&void 0===c.target.files?c.target.value?[{name:c.target.value.replace(/^.+\\/,"")}]:[]:c.target.files||{},j?a.each(m,function(a,b){d._filterDuplicate(b,f,r)}):f=m),b.isEmpty(f)||0===f.length)return j||d.clear(),d._showFolderError(q),d._raise("fileselectnone"),void 0;if(d._resetErrors(),l=f.length,h=d._getFileCount(d.isAjaxUpload?d.getFileStack().length+l:l),d.maxFileCount>0&&h>d.maxFileCount){if(!d.autoReplace||l>d.maxFileCount)return k=d.autoReplace&&l>d.maxFileCount?l:h,g=d.msgFilesTooMany.replace("{m}",d.maxFileCount).replace("{n}",k),d.isError=s(g,null,null,null),d.$captionContainer.removeClass("icon-visible"),d._setCaption("",!0),d.$container.removeClass("file-input-new file-input-ajax-new"),void 0;h>d.maxFileCount&&d._resetPreviewThumbs(j)}else!j||p?(d._resetPreviewThumbs(!1),p&&d.clearStack()):!j||0!==n||d.previewCache.count()&&!d.overwriteInitial||d._resetPreviewThumbs(!0);d.isPreviewable?d._readFiles(f):d._updateFileDetails(1),d._showFolderError(q)},_abort:function(b){var d,c=this;return c.ajaxAborted&&"object"==typeof c.ajaxAborted&&void 0!==c.ajaxAborted.message?(d=a.extend(!0,{},c._getOutData(),b),d.abortData=c.ajaxAborted.data||{},d.abortMessage=c.ajaxAborted.message,c._setProgress(101,c.$progress,c.msgCancelled),c._showUploadError(c.ajaxAborted.message,d,"filecustomerror"),c.cancel(),!0):!1},_resetFileStack:function(){var c=this,d=0,e=[],f=[],g=[];c._getThumbs().each(function(){var l,h=a(this),i=h.attr("data-fileindex"),j=c.filestack[i],k=h.attr("id");"-1"!==i&&-1!==i&&(void 0!==j?(e[d]=j,f[d]=c._getFileName(j),g[d]=c._getFileId(j),h.attr({id:c.previewInitId+"-"+d,"data-fileindex":d}),d++):(l="uploaded-"+b.uniqId(),h.attr({id:l,"data-fileindex":"-1"}),c.$preview.find("#zoom-"+k).attr("id","zoom-"+l)))}),c.filestack=e,c.filenames=f,c.fileids=g},_isFileSelectionValid:function(a){var b=this;return a=a||0,b.required&&!b.getFilesCount()?(b.$errorContainer.html(""),b._showUploadError(b.msgFileRequired),!1):b.minFileCount>0&&b._getFileCount(a)<b.minFileCount?(b._noFilesError({}),!1):!0},clearStack:function(){var a=this;return a.filestack=[],a.filenames=[],a.fileids=[],a.$element},updateStack:function(a,b){var c=this;return c.filestack[a]=b,c.filenames[a]=c._getFileName(b),c.fileids[a]=b&&c._getFileId(b)||null,c.$element},addToStack:function(a){var b=this;return b.filestack.push(a),b.filenames.push(b._getFileName(a)),b.fileids.push(b._getFileId(a)),b.$element},getFileStack:function(a){var b=this;return b.filestack.filter(function(b){return a?void 0!==b:void 0!==b&&null!==b})},getFilesCount:function(){var a=this,b=a.isAjaxUpload?a.getFileStack().length:a.$element.get(0).files.length;return a._getFileCount(b)},lock:function(){var a=this;return a._resetErrors(),a.disable(),a.showRemove&&a.$container.find(".fileinput-remove").hide(),a.showCancel&&a.$container.find(".fileinput-cancel").show(),a._raise("filelock",[a.filestack,a._getExtraData()]),a.$element},unlock:function(a){var b=this;return void 0===a&&(a=!0),b.enable(),b.showCancel&&b.$container.find(".fileinput-cancel").hide(),b.showRemove&&b.$container.find(".fileinput-remove").show(),a&&b._resetFileStack(),b._raise("fileunlock",[b.filestack,b._getExtraData()]),b.$element},cancel:function(){var e,b=this,c=b.ajaxRequests,d=c.length;if(d>0)for(e=0;d>e;e+=1)b.cancelling=!0,c[e].abort();return b._setProgressCancelled(),b._getThumbs().each(function(){var c=a(this),d=c.attr("data-fileindex");c.removeClass("file-uploading"),void 0!==b.filestack[d]&&(c.find(".kv-file-upload").removeClass("disabled").removeAttr("disabled"),c.find(".kv-file-remove").removeClass("disabled").removeAttr("disabled")),b.unlock()}),b.$element},clear:function(){var d,c=this;if(c._raise("fileclear"))return c.$btnUpload.removeAttr("disabled"),c._getThumbs().find("video,audio,img").each(function(){b.cleanMemory(a(this))}),c._resetUpload(),c.clearStack(),c._clearFileInput(),c._resetErrors(!0),c._hasInitialPreview()?(c._showFileIcon(),c._resetPreview(),c._initPreviewActions(),c.$container.removeClass("file-input-new")):(c._getThumbs().each(function(){c._clearObjects(a(this))}),c.isAjaxUpload&&(c.previewCache.data={}),c.$preview.html(""),d=!c.overwriteInitial&&c.initialCaption.length>0?c.initialCaption:"",c.$caption.attr("title","").val(d),b.addCss(c.$container,"file-input-new"),c._validateDefaultPreview()),0===c.$container.find(b.FRAMES).length&&(c._initCaption()||c.$captionContainer.removeClass("icon-visible")),c._hideFileIcon(),c._raise("filecleared"),c.$captionContainer.focus(),c._setFileDropZoneTitle(),c.$element},reset:function(){var a=this;if(a._raise("filereset"))return a._resetPreview(),a.$container.find(".fileinput-filename").text(""),b.addCss(a.$container,"file-input-new"),(a.getFrames().length||a.isAjaxUpload&&a.dropZoneEnabled)&&a.$container.removeClass("file-input-new"),a.clearStack(),a.formdata={},a._setFileDropZoneTitle(),a.$element},disable:function(){var a=this;return a.isDisabled=!0,a._raise("filedisabled"),a.$element.attr("disabled","disabled"),a.$container.find(".kv-fileinput-caption").addClass("file-caption-disabled"),a.$container.find(".fileinput-remove, .fileinput-upload, .file-preview-frame button").attr("disabled",!0),b.addCss(a.$container.find(".btn-file"),"disabled"),a._initDragDrop(),a.$element},enable:function(){var a=this;return a.isDisabled=!1,a._raise("fileenabled"),a.$element.removeAttr("disabled"),a.$container.find(".kv-fileinput-caption").removeClass("file-caption-disabled"),a.$container.find(".fileinput-remove, .fileinput-upload, .file-preview-frame button").removeAttr("disabled"),a.$container.find(".btn-file").removeClass("disabled"),a._initDragDrop(),a.$element},upload:function(){var e,f,g,c=this,d=c.getFileStack().length,h=!a.isEmptyObject(c._getExtraData());if(c.isAjaxUpload&&!c.isDisabled&&c._isFileSelectionValid(d)){if(c._resetUpload(),0===d&&!h)return c._showUploadError(c.msgUploadEmpty),void 0;if(c.$progress.show(),c.uploadCount=0,c.uploadStatus={},c.uploadLog=[],c.lock(),c._setProgress(2),0===d&&h)return c._uploadExtraOnly(),void 0;if(g=c.filestack.length,c.hasInitData=!1,!c.uploadAsync)return c._uploadBatch(),c.$element;for(f=c._getOutData(),c._raise("filebatchpreupload",[f]),c.fileBatchCompleted=!1,c.uploadCache={content:[],config:[],tags:[],append:!0},c.uploadAsyncCount=c.getFileStack().length,e=0;g>e;e++)c.uploadCache.content[e]=null,c.uploadCache.config[e]=null,c.uploadCache.tags[e]=null;for(c.$preview.find(".file-preview-initial").removeClass(b.SORT_CSS),c._initSortable(),c.cacheInitialPreview=c.getPreview(),e=0;g>e;e++)c.filestack[e]&&c._uploadSingle(e,!0)}},destroy:function(){var b=this,c=b.$form,d=b.$container,e=b.$element,f=b.namespace;return a(document).off(f),a(window).off(f),c&&c.length&&c.off(f),b.isAjaxUpload&&b._clearFileInput(),b._cleanup(),b._initPreviewCache(),e.insertBefore(d).off(f).removeData(),d.off().remove(),e},refresh:function(c,d){var e=this,f=e.$element;return c="object"!=typeof c||b.isEmpty(c)?e.options:a.extend(!0,{},e.options,c),e._init(c,!0),e._listen(),d&&f.trigger("change"+e.namespace),f},zoom:function(a){var c=this,d=c._getFrame(a),e=c.$modal;d&&(b.initModal(e),e.html(c._getModalContent()),c._setZoomContent(d),e.modal("show"),c._initZoomButtons())},getExif:function(a){var b=this,c=b._getFrame(a);return c&&c.data("exif")||null},getFrames:function(a){var c=this;return a=a||"",c.$preview.find(b.FRAMES+a)},getPreview:function(){var a=this;return{content:a.initialPreview,config:a.initialPreviewConfig,tags:a.initialPreviewThumbTags}}},a.fn.fileinput=function(d){if(b.hasFileAPISupport()||b.isIE(9)){var e=Array.apply(null,arguments),f=[];switch(e.shift(),this.each(function(){var n,g=a(this),h=g.data("fileinput"),i="object"==typeof d&&d,j=i.theme||g.data("theme"),k={},l={},m=i.language||g.data("language")||a.fn.fileinput.defaults.language||"en";h||(j&&(l=a.fn.fileinputThemes[j]||{}),"en"===m||b.isEmpty(a.fn.fileinputLocales[m])||(k=a.fn.fileinputLocales[m]||{}),n=a.extend(!0,{},a.fn.fileinput.defaults,l,a.fn.fileinputLocales.en,k,i,g.data()),h=new c(this,n),g.data("fileinput",h)),"string"==typeof d&&f.push(h[d].apply(h,e))}),f.length){case 0:return this;case 1:return f[0];default:return f}}},a.fn.fileinput.defaults={language:"en",showCaption:!0,showBrowse:!0,showPreview:!0,showRemove:!0,showUpload:!0,showCancel:!0,showClose:!0,showUploadedThumbs:!0,browseOnZoneClick:!1,autoReplace:!1,autoOrientImage:!0,required:!1,rtl:!1,hideThumbnailContent:!1,generateFileId:null,previewClass:"",captionClass:"",frameClass:"krajee-default",mainClass:"file-caption-main",mainTemplate:null,purifyHtml:!0,fileSizeGetter:null,initialCaption:"",initialPreview:[],initialPreviewDelimiter:"*$$*",initialPreviewAsData:!1,initialPreviewFileType:"image",initialPreviewConfig:[],initialPreviewThumbTags:[],previewThumbTags:{},initialPreviewShowDelete:!0,initialPreviewDownloadUrl:"",removeFromPreviewOnError:!1,deleteUrl:"",deleteExtraData:{},overwriteInitial:!0,previewZoomButtonIcons:{prev:'<i class="glyphicon glyphicon-triangle-left"></i>',next:'<i class="glyphicon glyphicon-triangle-right"></i>',toggleheader:'<i class="glyphicon glyphicon-resize-vertical"></i>',fullscreen:'<i class="glyphicon glyphicon-fullscreen"></i>',borderless:'<i class="glyphicon glyphicon-resize-full"></i>',close:'<i class="glyphicon glyphicon-remove"></i>'},previewZoomButtonClasses:{prev:"btn btn-navigate",next:"btn btn-navigate",toggleheader:"btn btn-kv btn-default btn-outline-secondary",fullscreen:"btn btn-kv btn-default btn-outline-secondary",borderless:"btn btn-kv btn-default btn-outline-secondary",close:"btn btn-kv btn-default btn-outline-secondary"},preferIconicPreview:!1,preferIconicZoomPreview:!1,allowedPreviewTypes:void 0,allowedPreviewMimeTypes:null,allowedFileTypes:null,allowedFileExtensions:null,defaultPreviewContent:null,customLayoutTags:{},customPreviewTags:{},previewFileIcon:'<i class="glyphicon glyphicon-file"></i>',previewFileIconClass:"file-other-icon",previewFileIconSettings:{},previewFileExtSettings:{},buttonLabelClass:"hidden-xs",browseIcon:'<i class="glyphicon glyphicon-folder-open"></i>&nbsp;',browseClass:"btn btn-primary",removeIcon:'<i class="glyphicon glyphicon-trash"></i>',removeClass:"btn btn-default btn-secondary",cancelIcon:'<i class="glyphicon glyphicon-ban-circle"></i>',cancelClass:"btn btn-default btn-secondary",uploadIcon:'<i class="glyphicon glyphicon-upload"></i>',uploadClass:"btn btn-default btn-secondary",uploadUrl:null,uploadUrlThumb:null,uploadAsync:!0,uploadExtraData:{},zoomModalHeight:480,minImageWidth:null,minImageHeight:null,maxImageWidth:null,maxImageHeight:null,resizeImage:!1,resizePreference:"width",resizeQuality:.92,resizeDefaultImageType:"image/jpeg",resizeIfSizeMoreThan:0,minFileSize:0,maxFileSize:0,maxFilePreviewSize:25600,minFileCount:0,maxFileCount:0,validateInitialCount:!1,msgValidationErrorClass:"text-danger",msgValidationErrorIcon:'<i class="glyphicon glyphicon-exclamation-sign"></i> ',msgErrorClass:"file-error-message",progressThumbClass:"progress-bar bg-success progress-bar-success progress-bar-striped active",progressClass:"progress-bar bg-success progress-bar-success progress-bar-striped active",progressCompleteClass:"progress-bar bg-success progress-bar-success",progressErrorClass:"progress-bar bg-danger progress-bar-danger",progressUploadThreshold:99,previewFileType:"image",elCaptionContainer:null,elCaptionText:null,elPreviewContainer:null,elPreviewImage:null,elPreviewStatus:null,elErrorContainer:null,errorCloseButton:'<button type="button" class="close kv-error-close">&times;</button>',slugCallback:null,dropZoneEnabled:!0,dropZoneTitleClass:"file-drop-zone-title",fileActionSettings:{},otherActionButtons:"",textEncoding:"UTF-8",ajaxSettings:{},ajaxDeleteSettings:{},showAjaxErrorDetails:!0,mergeAjaxCallbacks:!1,mergeAjaxDeleteCallbacks:!1,retryErrorUploads:!0},a.fn.fileinputLocales.en={fileSingle:"file",filePlural:"files",browseLabel:"Browse &hellip;",removeLabel:"Remove",removeTitle:"Clear selected files",cancelLabel:"Cancel",cancelTitle:"Abort ongoing upload",uploadLabel:"Upload",uploadTitle:"Upload selected files",msgNo:"No",msgNoFilesSelected:"No files selected",msgCancelled:"Cancelled",msgPlaceholder:"Select {files}...",msgZoomModalHeading:"Detailed Preview",msgFileRequired:"You must select a file to upload.",msgSizeTooSmall:'File "{name}" (<b>{size} KB</b>) is too small and must be larger than <b>{minSize} KB</b>.',msgSizeTooLarge:'File "{name}" (<b>{size} KB</b>) exceeds maximum allowed upload size of <b>{maxSize} KB</b>.',msgFilesTooLess:"You must select at least <b>{n}</b> {files} to upload.",msgFilesTooMany:"Number of files selected for upload <b>({n})</b> exceeds maximum allowed limit of <b>{m}</b>.",msgFileNotFound:'File "{name}" not found!',msgFileSecured:'Security restrictions prevent reading the file "{name}".',msgFileNotReadable:'File "{name}" is not readable.',msgFilePreviewAborted:'File preview aborted for "{name}".',msgFilePreviewError:'An error occurred while reading the file "{name}".',msgInvalidFileName:'Invalid or unsupported characters in file name "{name}".',msgInvalidFileType:'Invalid type for file "{name}". Only "{types}" files are supported.',msgInvalidFileExtension:'Invalid extension for file "{name}". Only "{extensions}" files are supported.',msgFileTypes:{image:"image",html:"HTML",text:"text",video:"video",audio:"audio",flash:"flash",pdf:"PDF",object:"object"},msgUploadAborted:"The file upload was aborted",msgUploadThreshold:"Processing...",msgUploadBegin:"Initializing...",msgUploadEnd:"Done",msgUploadEmpty:"No valid data available for upload.",msgUploadError:"Error",msgValidationError:"Validation Error",msgLoading:"Loading file {index} of {files} &hellip;",msgProgress:"Loading file {index} of {files} - {name} - {percent}% completed.",msgSelected:"{n} {files} selected",msgFoldersNotAllowed:"Drag & drop files only! {n} folder(s) dropped were skipped.",msgImageWidthSmall:'Width of image file "{name}" must be at least {size} px.',msgImageHeightSmall:'Height of image file "{name}" must be at least {size} px.',msgImageWidthLarge:'Width of image file "{name}" cannot exceed {size} px.',msgImageHeightLarge:'Height of image file "{name}" cannot exceed {size} px.',msgImageResizeError:"Could not get the image dimensions to resize.",msgImageResizeException:"Error while resizing the image.<pre>{errors}</pre>",msgAjaxError:"Something went wrong with the {operation} operation. Please try again later!",msgAjaxProgressError:"{operation} failed",ajaxOperations:{deleteThumb:"file delete",uploadThumb:"file upload",uploadBatch:"batch file upload",uploadExtra:"form data upload"},dropZoneTitle:"Drag & drop files here &hellip;",dropZoneClickTitle:"<br>(or click to select {files})",previewZoomButtonTitles:{prev:"View previous file",next:"View next file",toggleheader:"Toggle header",fullscreen:"Toggle full screen",borderless:"Toggle borderless mode",close:"Close detailed preview"}},a.fn.fileinput.Constructor=c,a(document).ready(function(){var b=a("input.file[type=file]");b.length&&b.fileinput()})}),function(a){"use strict";a.fn.fileinputLocales["zh"]={fileSingle:"",filePlural:"",browseLabel:" &hellip;",removeLabel:"",removeTitle:"",cancelLabel:"",cancelTitle:"",uploadLabel:"",uploadTitle:"",msgNo:"",msgNoFilesSelected:"",msgCancelled:"",msgPlaceholder:"Select {files}...",msgZoomModalHeading:"",msgFileRequired:".",msgSizeTooSmall:' "{name}" (<b>{size} KB</b>)  <b>{minSize} KB</b>.',msgSizeTooLarge:' "{name}" (<b>{size} KB</b>)  <b>{maxSize} KB</b>.',msgFilesTooLess:" <b>{n}</b> {files} . ",msgFilesTooMany:" <b>({n})</b>  <b>{m}</b>.",msgFileNotFound:' "{name}" !',msgFileSecured:' "{name}".',msgFileNotReadable:' "{name}" .',msgFilePreviewAborted:' "{name}" .',msgFilePreviewError:' "{name}" .',msgInvalidFileName:' "{name}" .',msgInvalidFileType:' "{name}".  "{types}" .',msgInvalidFileExtension:' "{name}".  "{extensions}" .',msgFileTypes:{image:"image",html:"HTML",text:"text",video:"video",audio:"audio",flash:"flash",pdf:"PDF",object:"object"},msgUploadAborted:"",msgUploadThreshold:"...",msgUploadBegin:"...",msgUploadEnd:"",msgUploadEmpty:".",msgUploadError:"Error",msgValidationError:"",msgLoading:" {index}   {files} &hellip;",msgProgress:" {index}   {files} - {name} - {percent}% .",msgSelected:"{n} {files} ",msgFoldersNotAllowed:"!  {n} .",msgImageWidthSmall:'"{name}"{size}.',msgImageHeightSmall:'"{name}"{size}.',msgImageWidthLarge:'"{name}"{size}.',msgImageHeightLarge:'"{name}"{size}.',msgImageResizeError:"",msgImageResizeException:"<pre>{errors}</pre>",msgAjaxError:"{operation} . !",msgAjaxProgressError:"{operation} ",ajaxOperations:{deleteThumb:"",uploadThumb:"",uploadBatch:"",uploadExtra:""},dropZoneTitle:" &hellip;<br>",dropZoneClickTitle:"<br>({files})",fileActionSettings:{removeTitle:"",uploadTitle:"",uploadRetryTitle:"Retry upload",zoomTitle:"",dragTitle:" / ",indicatorNewTitle:"",indicatorSuccessTitle:"",indicatorErrorTitle:"",indicatorLoadingTitle:" ..."},previewZoomButtonTitles:{prev:"",next:"",toggleheader:"",fullscreen:"",borderless:"",close:""}}}(window.jQuery);